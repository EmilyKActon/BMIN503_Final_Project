---
title: "National Trends and Utilization Patterns for Antithrombotic Drugs Among Adults with a History of Cancer: NHANES 2011-2018"
author: "Emily Acton"
output:
  html_document:
    toc: no
    depth: 3
    theme: paper
    highlight: tango
  pdf_document:
    toc: no
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```  
***


# Overview

Antithrombotic agents have increasingly been recognized as having a role in the treatment of populations with cancer, with purported preventative effects relative to tumorigenesis, metastasis, and cancer-associated thromboses.  In my area of research focus, there has been growing attention to the significantly increased risk of ischemic strokes among those with cancer. Yet, the mechanisms underlying and optimal antithrombotic-based prevention strategies for cancer-associated strokes remain incompletely understood.  An essential step towards building further clinical trials and observational studies to advance this understanding will be assessment of current real-world trends in utilization of antithrombotic drugs among adults with cancer.  

In order to ensure maximal clinical relevance of my exploratory assessment of these trends, I sought guidance from Dr. Scott E. Kasner, MD, MSCE, Dr. Brett L. Cucchiara, MD, and John T. Farrar, MD, PhD, with collective expertise across the fields of vascular neurology, oncology, and epidemiology.  From these meetings, I received key input on which antithrombotic drugs to evaluate, how to define the cancer populations of interest, which variables should be parsed, and how to best present results.  Using the unique combination of interview data on demographics, comorbidities, and medications collected as part of the National Health and Nutrition Examination Survey (NHANES), I aimed to investigate national trends and patterns of antithrombotic drug use among adults with a history of cancer. The final GitHub repository for this project can be found at: https://github.com/EmilyKActon/BMIN503_Final_Project




# Introduction 

Estimates suggest 10% of ischemic strokes occur among those with active cancer, with a markedly increased risk of ischemic stroke demonstrated following incident cancer diagnosis.[1-3]  Moreover, these numbers may be on the rise as recent treatment advancements have dramatically increased the length of survival with cancer.[1]  While in the last few years the topic of cancer-associated stroke has garnered growing attention in the scientific literature, treatment strategies for primary and secondary prevention remain poorly defined, and critically in need of further investigation.[4,5]  Antithrombotic drugs, including antiplatelets and anticoagulants, are central to these stroke prevention strategies.[4,5]  However, research into the effectiveness of these drugs is stymied by gaps in knowledge about current real-world utilization patterns for antithrombotic agents among populations with a history of cancer.  Improved understanding about these utilization trends has value extending well beyond its implications for stroke prevention given mounting evidence of potential anti-tumorigenesis and anti-metastatic properties of antithrombotic drugs, coupled with their recognized importance in cancer-associated venous thromboembolism prevention.[6]

At its core, this research question about antithrombotic drug utilization among adults with a history of cancer exists at the intersection of neurology, oncology, pharmacology, and epidemiology, with the input of all four disciplines necessary to arrive at a meaningful study design and analysis plan.  Furthermore, in-depth interpretation of medication use patterns among the growing population of cancer survivors may connect with and require incorporation of knowledge from an even broader range of fields in medicine and the social sciences.  In my meetings with physician-researchers with expertise in a combination of these fields, I gained vital insights about: 1). Selection of the key anticoagulants for evaluation, specifically aspirin and a grouped category of high-relevance anticoagulants; 2). Definition of the cancer populations of interest, specifically in terms of operationalizing cancer “recency”; 3). Determination of the most critical variables for detailed examination, including age and cancer type; and, 4). Visualization of the data (i.e., best use of Figures/Tables), particularly given the focus of this project is more exploratory in nature.  These insights were integral in the development of my overall analysis plan (described below in the Methods). Building from the knowledge obtained in my consultations with these content experts, I will utilize data collected as part of the National Health and Nutrition Examination Survey (NHANES) to investigate the trends and patterns of antithrombotic use among adults with a history of cancer in the US from 2011-2018.



# Methods

## Information Source

The National Health and Nutrition Examination Survey (NHANES) is an ongoing series of surveys conducted by the National Center for Health Statistics (NCHS) within the US Centers for Disease Control and Prevention (CDC). NHANES consists of complex, multistage, probability samples of children and adults, and aims to obtain data that facilitates continuous evaluation of the health and nutritional status of the US population. Through a combination of interviews and physical examinations, data is collected across a ranges of areas, including demographics, socioeconomic indicators, health and disease measures, medication use, dietary practices, laboratory tests, and physiological measurements. [7] 



## Downloading Packages and Data

First, all packages used for this project were loaded.

```{r eval = TRUE, message = FALSE}

# Load all packages used for this project
library(nhanesA) 
library(dplyr)
library(ggplot2)
library(survey)
library(table1)
library(reshape2)
library(forcats)
library(ggsci)
library(knitr)
library(kableExtra)
library(gtsummary)

```



Then, data was loaded from the relevant NHANES modules, including: DEMO=Demographic Variables & Sample Weights, MCQ=Medical Conditions, RXQ_RX=Prescription Medications, and RXQASA = Preventive Aspirin Use.  These modules were loaded for the cycles from 2011-2018 (G=2011-2012, H=2013-2014, I=2015-2016, and J=2017-2018).

```{r eval = TRUE, message = FALSE}

# LOad data from relevant modules and cycles 
varlist <- c("DEMO", "MCQ", "RXQ_RX", "RXQASA") 
varlist_years <- paste0(rep(varlist, each = 4), c("_G", "_H", "_I", "_J"))

list_all <- sapply(varlist_years, function(x) {data.frame(nhanes(x))}) 


#Create a data.frame for each module
for(i in 1:length(list_all)) {
  assign(names(list_all)[i], list_all[[i]])
} 

#Remove objects that are no longer needed
rm(list_all)

```



## Data Cleaning

A data frame was generated for each cycle combining all relevant modules (DEMO, MCQ, RXQ_RX, RXQASA).  From these data frames, relevant variable were selected, renamed, and transformed (specifically, factors were generated to replace binary/categorical variables for gender, race, history of cancer, preventative aspirin use, history of stroke, and history of myocardial infarction (MI))

```{r eval = TRUE, message = FALSE}

# Generate 1 data frame per cycle (selecting and transforming relevant variables)

#2011-2012
cycle.11.12 <- left_join(DEMO_G, MCQ_G, by="SEQN") 

cycle.11.12 <- left_join(cycle.11.12, RXQ_RX_G, by="SEQN")

cycle.11.12 <- left_join(cycle.11.12, RXQASA_G, by="SEQN") %>%
  select(id = SEQN, cycle = SDDSRVYR, gender = RIAGENDR, age = RIDAGEYR, race =        RIDRETH1, hx.can = MCQ220, type.can1 = MCQ230A, type.can2 = MCQ230B, type.can3 =     MCQ230C, type.can4 = MCQ230D, age.bladder.can = MCQ240A, age.testi.can = MCQ240AA,   age.blood.can = MCQ240B, age.thyroid.can = MCQ240BB, age.bone.can = MCQ240C,         age.uteri.can = MCQ240CC, age.brain.can = MCQ240D, age.other.can = MCQ240DD,         age.unk.can = MCQ240DK, age.breast.can = MCQ240E, age.cervic.can = MCQ240F,          age.colon.can = MCQ240G, age.esoph.can = MCQ240H, age.gallblad.can = MCQ240I,        age.kidney.can = MCQ240J, age.larynx.can = MCQ240K, age.leukem.can = MCQ240L,        age.liver.can = MCQ240M, age.lung.can = MCQ240N, age.lymph.can = MCQ240O,            age.melano.can = MCQ240P, age.mouth.can = MCQ240Q, age.nerv.can = MCQ240R,           age.ovari.can = MCQ240S, age.pancr.can = MCQ240T, age.prost.can = MCQ240U,           age.rectal.can = MCQ240V, age.non.mela.can = MCQ240W, age.unk.skin.can = MCQ240X,    age.soft.can = MCQ240Y, age.stomach.can = MCQ240Z, drug = RXDDRGID, aspirin.dr =     RXQ515, aspirin.own = RXQ520, hx.stroke = MCQ160F, hx.mi = MCQ160E, int.weight =     WTINT2YR, psu = SDMVPSU, strata = SDMVSTRA) %>%
  mutate(gender = factor(gender, levels = c(1, 2), labels = c("Male", "Female"))) %>%
  mutate(race = factor(race, levels = c(3, 1, 2, 4, 5), labels = c("White",            "MexicanAmerican", "Hispanic", "Black", "Other"))) %>%
  mutate(hx.can = factor(hx.can, levels=c(1, 2, 7, 9), labels = c("Yes", "No", NA,     NA))) %>%
  mutate(aspirin.dr = factor(aspirin.dr, levels=c(1, 2, 3, 4), labels = c("Yes",       "No", "Sometimes", "Stopped"))) %>%
  mutate(aspirin.own = factor(aspirin.own, levels=c(1, 2, 7, 9), labels = c("Yes",     "No", NA, NA))) %>%
  mutate(hx.stroke = factor(hx.stroke, levels=c(1, 2, 7, 9), labels = c("Yes", "No",   NA, NA))) %>%
  mutate(hx.mi = factor(hx.mi, levels=c(1, 2, 7, 9), labels = c("Yes", "No", NA,       NA))) 


#2013-2014
cycle.13.14 <- left_join(DEMO_H, MCQ_H, by="SEQN") 

cycle.13.14 <- left_join(cycle.13.14, RXQ_RX_H, by="SEQN")

cycle.13.14 <- left_join(cycle.13.14, RXQASA_H, by="SEQN") %>%
  select(id = SEQN, cycle = SDDSRVYR, gender = RIAGENDR, age = RIDAGEYR, race =        RIDRETH1, hx.can = MCQ220, type.can1 = MCQ230A, type.can2 = MCQ230B, type.can3 =     MCQ230C, type.can4 = MCQ230D, age.bladder.can = MCQ240A, age.testi.can = MCQ240AA,   age.blood.can = MCQ240B, age.thyroid.can = MCQ240BB, age.bone.can = MCQ240C,         age.uteri.can = MCQ240CC, age.brain.can = MCQ240D, age.other.can = MCQ240DD,         age.unk.can = MCQ240DK, age.breast.can = MCQ240E, age.cervic.can = MCQ240F,          age.colon.can = MCQ240G, age.esoph.can = MCQ240H, age.gallblad.can = MCQ240I,        age.kidney.can = MCQ240J, age.larynx.can = MCQ240K, age.leukem.can = MCQ240L,        age.liver.can = MCQ240M, age.lung.can = MCQ240N, age.lymph.can = MCQ240O,            age.melano.can = MCQ240P, age.mouth.can = MCQ240Q, age.nerv.can = MCQ240R,           age.ovari.can = MCQ240S, age.pancr.can = MCQ240T, age.prost.can = MCQ240U,           age.rectal.can = MCQ240V, age.non.mela.can = MCQ240W, age.unk.skin.can = MCQ240X,    age.soft.can = MCQ240Y, age.stomach.can = MCQ240Z, drug = RXDDRGID, aspirin.dr =     RXQ515, aspirin.own = RXQ520, hx.stroke = MCQ160F, hx.mi = MCQ160E, int.weight =     WTINT2YR, psu = SDMVPSU, strata = SDMVSTRA) %>%
  mutate(gender = factor(gender, levels = c(1, 2), labels = c("Male", "Female"))) %>%
  mutate(race = factor(race, levels = c(3, 1, 2, 4, 5), labels = c("White",            "MexicanAmerican", "Hispanic", "Black", "Other"))) %>%
  mutate(hx.can = factor(hx.can, levels=c(1, 2, 7, 9), labels = c("Yes", "No", NA,     NA))) %>%
  mutate(aspirin.dr = factor(aspirin.dr, levels=c(1, 2, 3, 4), labels = c("Yes",       "No", "Sometimes", "Stopped"))) %>%
  mutate(aspirin.own = factor(aspirin.own, levels=c(1, 2, 7, 9), labels = c("Yes",     "No", NA, NA))) %>%
  mutate(hx.stroke = factor(hx.stroke, levels=c(1, 2, 7, 9), labels = c("Yes", "No",   NA, NA))) %>%
  mutate(hx.mi = factor(hx.mi, levels=c(1, 2, 7, 9), labels = c("Yes", "No", NA,       NA))) 


#2015-2016
cycle.15.16 <- left_join(DEMO_I, MCQ_I, by="SEQN") 

cycle.15.16 <- left_join(cycle.15.16, RXQ_RX_I, by="SEQN")

cycle.15.16 <- left_join(cycle.15.16, RXQASA_I, by="SEQN") %>%
  select(id = SEQN, cycle = SDDSRVYR, gender = RIAGENDR, age = RIDAGEYR, race =        RIDRETH1, hx.can = MCQ220, type.can1 = MCQ230A, type.can2 = MCQ230B, type.can3 =     MCQ230C, type.can4 = MCQ230D, age.bladder.can = MCQ240A, age.testi.can = MCQ240AA,   age.blood.can = MCQ240B, age.thyroid.can = MCQ240BB, age.bone.can = MCQ240C,         age.uteri.can = MCQ240CC, age.brain.can = MCQ240D, age.other.can = MCQ240DD,         age.unk.can = MCQ240DK, age.breast.can = MCQ240E, age.cervic.can = MCQ240F,          age.colon.can = MCQ240G, age.esoph.can = MCQ240H, age.gallblad.can = MCQ240I,        age.kidney.can = MCQ240J, age.larynx.can = MCQ240K, age.leukem.can = MCQ240L,        age.liver.can = MCQ240M, age.lung.can = MCQ240N, age.lymph.can = MCQ240O,            age.melano.can = MCQ240P, age.mouth.can = MCQ240Q, age.nerv.can = MCQ240R,           age.ovari.can = MCQ240S, age.pancr.can = MCQ240T, age.prost.can = MCQ240U,           age.rectal.can = MCQ240V, age.non.mela.can = MCQ240W, age.unk.skin.can = MCQ240X,    age.soft.can = MCQ240Y, age.stomach.can = MCQ240Z, drug = RXDDRGID, aspirin.dr =     RXQ515, aspirin.own = RXQ520, hx.stroke = MCQ160F, hx.mi = MCQ160E, int.weight =     WTINT2YR, psu = SDMVPSU, strata = SDMVSTRA) %>%
  mutate(gender = factor(gender, levels = c(1, 2), labels = c("Male", "Female"))) %>%
  mutate(race = factor(race, levels = c(3, 1, 2, 4, 5), labels = c("White",            "MexicanAmerican", "Hispanic", "Black", "Other"))) %>%
  mutate(hx.can = factor(hx.can, levels=c(1, 2, 7, 9), labels = c("Yes", "No", NA,     NA))) %>%
  mutate(aspirin.dr = factor(aspirin.dr, levels=c(1, 2, 3, 4), labels = c("Yes",       "No", "Sometimes", "Stopped"))) %>%
  mutate(aspirin.own = factor(aspirin.own, levels=c(1, 2, 7, 9), labels = c("Yes",     "No", NA, NA))) %>%
  mutate(hx.stroke = factor(hx.stroke, levels=c(1, 2, 7, 9), labels = c("Yes", "No",   NA, NA))) %>%
  mutate(hx.mi = factor(hx.mi, levels=c(1, 2, 7, 9), labels = c("Yes", "No", NA,       NA))) 


#2017-2018
cycle.17.18 <- left_join(DEMO_J, MCQ_J, by="SEQN") 

cycle.17.18 <- left_join(cycle.17.18, RXQ_RX_J, by="SEQN")

cycle.17.18 <- left_join(cycle.17.18, RXQASA_J, by="SEQN") %>%
  select(id = SEQN, cycle = SDDSRVYR, gender = RIAGENDR, age = RIDAGEYR, race =        RIDRETH1, hx.can = MCQ220, type.1st.can = MCQ230A, age.1st.can = MCD240A,            type.2nd.can = MCQ230B, age.2nd.can = MCD240B, type.3rd.can = MCQ230C, age.3rd.can   = MCD240C, drug = RXDDRGID, aspirin.dr = RXQ515, aspirin.own = RXQ520, hx.stroke =   MCQ160F, hx.mi = MCQ160E, int.weight = WTINT2YR, psu = SDMVPSU, strata = SDMVSTRA)   %>%
  mutate(gender = factor(gender, levels = c(1, 2), labels = c("Male", "Female"))) %>%
  mutate(race = factor(race, levels = c(3, 1, 2, 4, 5), labels = c("White",            "MexicanAmerican", "Hispanic", "Black", "Other"))) %>%
  mutate(hx.can = factor(hx.can, levels=c(1, 2, 7, 9), labels = c("Yes", "No", NA,     NA))) %>%
  mutate(aspirin.dr = factor(aspirin.dr, levels=c(1, 2, 3, 4), labels = c("Yes",       "No", "Sometimes", "Stopped"))) %>%
  mutate(aspirin.own = factor(aspirin.own, levels=c(1, 2, 7, 9), labels = c("Yes",     "No", NA, NA))) %>%
  mutate(hx.stroke = factor(hx.stroke, levels=c(1, 2, 7, 9), labels = c("Yes", "No",   NA, NA))) %>%
  mutate(hx.mi = factor(hx.mi, levels=c(1, 2, 7, 9), labels = c("Yes", "No", NA,       NA))) 

```



A variable was generated to indicate the presence of self-reported anticoagulant use in the past 30 days.  Medications included in this combined anticoagulant variable for the purposes of this assessment were: direct-acting oral anticoagulants (DOACs) (apixaban [d07804], dabigatran [d07137], rivaroxaban[d07356]); low molecular weight heparins (LMWHs)(dalteparin [d03812] or enoxaparin[d03041]); and, warfarin [d00022]. (Note: The numbers indicated in brackets after each medication are the unique generic drug codes from Multum’s Lexicon Drug Database that are used as identifiers in NHANES). Then, the variable indicating anticoagulant use was applied to all observations for a given id.

```{r eval = TRUE, message = FALSE}

#Generate a variable for anticoagulant use, and apply to all observations for a given id

#2011-2012
cycle.11.12 <- mutate(cycle.11.12, anticoag = ifelse((drug == "d07804"| drug ==     "d07137"| drug == "d07356"|drug == "d03812"| drug == "d03041"|drug == "d00022"),      1, 0))

anticoag.cycle.11.12 <- cycle.11.12 %>%
  filter(anticoag == 1) %>%
  select(id, anticoag) 

cycle.11.12 <-  cycle.11.12 %>%
  select(-anticoag) 
  
cycle.11.12 <- left_join(cycle.11.12, anticoag.cycle.11.12, by="id")

rm(anticoag.cycle.11.12)

cycle.11.12$anticoag[is.na(cycle.11.12$anticoag)] = 0

cycle.11.12 <- mutate(cycle.11.12, anticoag = factor(anticoag, levels=c(1, 0), labels = c("Yes", "No"))) 


#2013-2014
cycle.13.14 <- mutate(cycle.13.14, anticoag = ifelse((drug == "d07804"| drug ==     "d07137"| drug == "d07356"|drug == "d03812"| drug == "d03041"|drug == "d00022"), 1, 0))

anticoag.cycle.13.14 <- cycle.13.14 %>%
  filter(anticoag == 1) %>%
  select(id, anticoag) 

cycle.13.14 <-  cycle.13.14 %>%
  select(-anticoag) 
  
cycle.13.14 <- left_join(cycle.13.14, anticoag.cycle.13.14, by="id")

rm(anticoag.cycle.13.14)

cycle.13.14$anticoag[is.na(cycle.13.14$anticoag)] = 0

cycle.13.14 <- mutate(cycle.13.14, anticoag = factor(anticoag, levels=c(1, 0), labels = c("Yes", "No"))) 


#2015-2016
cycle.15.16 <- mutate(cycle.15.16, anticoag = ifelse((drug == "d07804"| drug ==     "d07137"| drug == "d07356"|drug == "d03812"| drug == "d03041"|drug == "d00022"), 1, 0))

anticoag.cycle.15.16 <- cycle.15.16 %>%
  filter(anticoag == 1) %>%
  select(id, anticoag) 

cycle.15.16 <-  cycle.15.16 %>%
  select(-anticoag) 
  
cycle.15.16 <- left_join(cycle.15.16, anticoag.cycle.15.16, by="id")

rm(anticoag.cycle.15.16)

cycle.15.16$anticoag[is.na(cycle.15.16$anticoag)] = 0

cycle.15.16 <- mutate(cycle.15.16, anticoag = factor(anticoag, levels=c(1, 0), labels = c("Yes", "No")))


#2017-2018
cycle.17.18 <- mutate(cycle.17.18, anticoag = ifelse((drug == "d07804"| drug ==     "d07137"| drug == "d07356"|drug == "d03812"| drug == "d03041"|drug == "d00022"), 1, 0))

anticoag.cycle.17.18 <- cycle.17.18 %>%
  filter(anticoag == 1) %>%
  select(id, anticoag) 

cycle.17.18 <-  cycle.17.18 %>%
  select(-anticoag) 
  
cycle.17.18 <- left_join(cycle.17.18, anticoag.cycle.17.18, by="id")

rm(anticoag.cycle.17.18)

cycle.17.18$anticoag[is.na(cycle.17.18$anticoag)] = 0

cycle.17.18 <- mutate(cycle.17.18, anticoag = factor(anticoag, levels=c(1, 0), labels = c("Yes", "No")))

```



With the variable indicating the presence of anticoagulant drug use applied to all rows for a given id, the multiple rows for each id (a byproduct of there being a row for each drug reported by a given participant) were eliminated, resulting in data frames with one row per id. 

```{r eval = TRUE, message = FALSE}

#Identify the number of duplicate rows based on id, and remove duplicate rows  

#2011-2012
sum(duplicated(cycle.11.12$id))
cycle.11.12 <- distinct(cycle.11.12, id, .keep_all= TRUE)


#2013-2014
sum(duplicated(cycle.13.14$id))
cycle.13.14 <- distinct(cycle.13.14, id, .keep_all= TRUE)


#2015-2016
sum(duplicated(cycle.15.16$id))
cycle.15.16 <- distinct(cycle.15.16, id, .keep_all= TRUE)


#2017-2018
sum(duplicated(cycle.17.18$id))
cycle.17.18 <- distinct(cycle.17.18, id, .keep_all= TRUE)

```



A variable was generated to indicate the presence of self-reported low-dose aspirin use for heart attack, stroke, and/or cancer prevention (including both doctor recommended and self-initiated aspirin use).  Note: This assessment is focused on low-dose, preventive aspirin use (i.e. does not include more general prescription aspirin use for indications other than heart attack, stroke, and/or cancer prevention). 

```{r eval = TRUE, message = FALSE}

# Generate variable for any reported low-dose, preventative aspirin use

#2011-2012
cycle.11.12$aspirin.any <- rep(0, nrow(cycle.11.12))
cycle.11.12$aspirin.any[which(cycle.11.12$aspirin.dr=="Yes")] <- 1
cycle.11.12$aspirin.any[which(cycle.11.12$aspirin.dr=="Sometimes")] <- 1
cycle.11.12$aspirin.any[which(cycle.11.12$aspirin.own=="Yes")] <- 1
cycle.11.12 <- mutate(cycle.11.12, aspirin.any = factor(aspirin.any, levels=c(1, 0), labels = c("Yes", "No"))) 


#2013-2014
cycle.13.14$aspirin.any <- rep(0, nrow(cycle.13.14))
cycle.13.14$aspirin.any[which(cycle.13.14$aspirin.dr=="Yes")] <- 1
cycle.13.14$aspirin.any[which(cycle.13.14$aspirin.dr=="Sometimes")] <- 1
cycle.13.14$aspirin.any[which(cycle.13.14$aspirin.own=="Yes")] <- 1
cycle.13.14 <- mutate(cycle.13.14, aspirin.any = factor(aspirin.any, levels=c(1, 0), labels = c("Yes", "No"))) 


#2015-2016
cycle.15.16$aspirin.any <- rep(0, nrow(cycle.15.16))
cycle.15.16$aspirin.any[which(cycle.15.16$aspirin.dr=="Yes")] <- 1
cycle.15.16$aspirin.any[which(cycle.15.16$aspirin.dr=="Sometimes")] <- 1
cycle.15.16$aspirin.any[which(cycle.15.16$aspirin.own=="Yes")] <- 1
cycle.15.16 <- mutate(cycle.15.16, aspirin.any = factor(aspirin.any, levels=c(1, 0), labels = c("Yes", "No")))


#2017-2018
cycle.17.18$aspirin.any <- rep(0, nrow(cycle.17.18))
cycle.17.18$aspirin.any[which(cycle.17.18$aspirin.dr=="Yes")] <- 1
cycle.17.18$aspirin.any[which(cycle.17.18$aspirin.dr=="Sometimes")] <- 1
cycle.17.18$aspirin.any[which(cycle.17.18$aspirin.own=="Yes")] <- 1
cycle.17.18 <- mutate(cycle.17.18, aspirin.any = factor(aspirin.any, levels=c(1, 0), labels = c("Yes", "No")))

```


A variable was generated to indicate those with a recent history of cancer, which was defined as either: one or more cancer diagnosis when the participant was no more than 5 years younger than they were on the date of NHANES interview participation, or one or more cancer diagnosis when the participant was 75 years of age or older (regardless of age at the date of NHANES interview participation). The latter definition was included to account for NHANES capping age information at 80 years.

```{r eval = TRUE, message = FALSE}

# Change any age of cancer listings of "Refused" (77777) or "Don't Know" (99999) to NA 
#2011-2012
cycle.11.12[11:41] <- cycle.11.12[11:41] %>%
                      mutate_all(~replace(., . == 77777, NA)) %>%
                      mutate_all(~replace(., . == 99999, NA))

                      
#2013-2014
cycle.13.14[11:41] <- cycle.13.14[11:41] %>%
                      mutate_all(~replace(., . == 77777, NA)) %>%
                      mutate_all(~replace(., . == 99999, NA))                      
                      

#2015-2016
cycle.15.16[11:41] <- cycle.15.16[11:41] %>%
                      mutate_all(~replace(., . == 77777, NA)) %>%
                      mutate_all(~replace(., . == 99999, NA))                     
                      

#2017-2018
cycle.17.18[c(8, 10, 12)] <- cycle.17.18[c(8, 10, 12)] %>%
                             mutate_all(~replace(., . == 77777, NA)) %>%
                             mutate_all(~replace(., . == 99999, NA))   



# Generate a variable to indicate if there was a recent history of cancer

#2011-2012
cycle.11.12 <- cycle.11.12 %>%
  mutate(bladder.can = age - age.bladder.can) %>%
  mutate(testi.can = age - age.testi.can) %>%
  mutate(blood.can = age - age.blood.can) %>%
  mutate(thyroid.can = age - age.thyroid.can) %>%
  mutate(bone.can = age - age.bone.can) %>%
  mutate(uteri.can = age - age.uteri.can) %>%
  mutate(brain.can = age - age.brain.can) %>%
  mutate(other.can = age - age.other.can) %>%
  mutate(unk.can = age - age.unk.can) %>%
  mutate(breast.can = age - age.breast.can) %>%
  mutate(cervic.can = age - age.cervic.can) %>%
  mutate(colon.can = age - age.colon.can) %>%
  mutate(esoph.can = age - age.esoph.can) %>%
  mutate(gallblad.can = age - age.gallblad.can) %>%
  mutate(kidney.can = age - age.kidney.can) %>%
  mutate(larynx.can = age - age.larynx.can) %>%
  mutate(leukem.can = age - age.leukem.can) %>%
  mutate(liver.can = age - age.liver.can) %>%
  mutate(lung.can = age - age.lung.can) %>%
  mutate(lymph.can = age - age.lymph.can) %>%
  mutate(melano.can = age - age.melano.can) %>%
  mutate(mouth.can = age - age.mouth.can) %>%
  mutate(nerv.can = age - age.nerv.can) %>%
  mutate(ovari.can = age - age.ovari.can) %>%
  mutate(pancr.can = age - age.pancr.can) %>%
  mutate(prost.can = age - age.prost.can) %>%
  mutate(rectal.can = age - age.rectal.can) %>%
  mutate(non.mela.can = age - age.non.mela.can) %>%
  mutate(unk.skin.can = age - age.unk.skin.can) %>%
  mutate(soft.can = age - age.soft.can) %>%
  mutate(stomach.can = age - age.stomach.can) 

cycle.11.12[52:82] <- lapply(cycle.11.12[52:82], as.numeric)

cycle.11.12 <- cycle.11.12 %>%
  mutate(bladder.can = ifelse(bladder.can <= 5, 1, 0)) %>%
  mutate(testi.can = ifelse(testi.can <= 5, 1, 0)) %>%
  mutate(blood.can = ifelse(blood.can <= 5, 1, 0)) %>%
  mutate(thyroid.can = ifelse(thyroid.can <= 5, 1, 0)) %>%
  mutate(bone.can = ifelse(bone.can <= 5, 1, 0)) %>%
  mutate(uteri.can = ifelse(uteri.can <= 5, 1, 0)) %>%
  mutate(brain.can = ifelse(brain.can <= 5, 1, 0)) %>%
  mutate(other.can = ifelse(other.can <= 5, 1, 0)) %>%
  mutate(unk.can = ifelse(unk.can <= 5, 1, 0)) %>%
  mutate(breast.can = ifelse(breast.can <= 5, 1, 0)) %>%
  mutate(cervic.can = ifelse(cervic.can <= 5, 1, 0)) %>%
  mutate(colon.can = ifelse(colon.can <= 5, 1, 0)) %>%
  mutate(esoph.can = ifelse(esoph.can <= 5, 1, 0)) %>%
  mutate(gallblad.can = ifelse(gallblad.can <= 5, 1, 0)) %>%
  mutate(kidney.can = ifelse(kidney.can <= 5, 1, 0)) %>%
  mutate(larynx.can = ifelse(larynx.can <= 5, 1, 0)) %>%
  mutate(leukem.can = ifelse(leukem.can <= 5, 1, 0)) %>%
  mutate(liver.can = ifelse(liver.can <= 5, 1, 0)) %>%
  mutate(lung.can = ifelse(lung.can <= 5, 1, 0)) %>%
  mutate(lymph.can = ifelse(lymph.can <= 5, 1, 0)) %>%
  mutate(melano.can = ifelse(melano.can <= 5, 1, 0)) %>%
  mutate(mouth.can = ifelse(mouth.can <= 5, 1, 0)) %>%
  mutate(nerv.can = ifelse(nerv.can <= 5, 1, 0)) %>%
  mutate(ovari.can = ifelse(ovari.can <= 5, 1, 0)) %>%
  mutate(pancr.can = ifelse(pancr.can <= 5, 1, 0)) %>%
  mutate(prost.can = ifelse(prost.can <= 5, 1, 0)) %>%
  mutate(rectal.can = ifelse(rectal.can <= 5, 1, 0)) %>%
  mutate(non.mela.can = ifelse(non.mela.can <= 5, 1, 0)) %>%
  mutate(unk.skin.can = ifelse(unk.skin.can <= 5, 1, 0)) %>%
  mutate(soft.can = ifelse(soft.can <= 5, 1, 0)) %>%
  mutate(stomach.can = ifelse(stomach.can <= 5, 1, 0))

sum.cycle.11.12 <- cycle.11.12 %>%
   select(1, 52:82) %>%
   replace(is.na(.), 0) %>%
   mutate(cancer.recent = rowSums(.[2:32]))%>%
   mutate(cancer.recent = ifelse(cancer.recent >= 1, 1, 0)) %>%
   mutate(cancer.recent = factor(cancer.recent, levels=c(1, 0), labels = c("Yes",        "No"))) %>%
   select(1, 33)

cycle.11.12 <- left_join(cycle.11.12, sum.cycle.11.12, by="id")
 
rm(sum.cycle.11.12)


#2013-2014
cycle.13.14 <- cycle.13.14 %>%
  mutate(bladder.can = age - age.bladder.can) %>%
  mutate(testi.can = age - age.testi.can) %>%
  mutate(blood.can = age - age.blood.can) %>%
  mutate(thyroid.can = age - age.thyroid.can) %>%
  mutate(bone.can = age - age.bone.can) %>%
  mutate(uteri.can = age - age.uteri.can) %>%
  mutate(brain.can = age - age.brain.can) %>%
  mutate(other.can = age - age.other.can) %>%
  mutate(unk.can = age - age.unk.can) %>%
  mutate(breast.can = age - age.breast.can) %>%
  mutate(cervic.can = age - age.cervic.can) %>%
  mutate(colon.can = age - age.colon.can) %>%
  mutate(esoph.can = age - age.esoph.can) %>%
  mutate(gallblad.can = age - age.gallblad.can) %>%
  mutate(kidney.can = age - age.kidney.can) %>%
  mutate(larynx.can = age - age.larynx.can) %>%
  mutate(leukem.can = age - age.leukem.can) %>%
  mutate(liver.can = age - age.liver.can) %>%
  mutate(lung.can = age - age.lung.can) %>%
  mutate(lymph.can = age - age.lymph.can) %>%
  mutate(melano.can = age - age.melano.can) %>%
  mutate(mouth.can = age - age.mouth.can) %>%
  mutate(nerv.can = age - age.nerv.can) %>%
  mutate(ovari.can = age - age.ovari.can) %>%
  mutate(pancr.can = age - age.pancr.can) %>%
  mutate(prost.can = age - age.prost.can) %>%
  mutate(rectal.can = age - age.rectal.can) %>%
  mutate(non.mela.can = age - age.non.mela.can) %>%
  mutate(unk.skin.can = age - age.unk.skin.can) %>%
  mutate(soft.can = age - age.soft.can) %>%
  mutate(stomach.can = age - age.stomach.can) 

cycle.13.14[52:82] <- lapply(cycle.13.14[52:82], as.numeric)

cycle.13.14 <- cycle.13.14 %>%
  mutate(bladder.can = ifelse(bladder.can <= 5, 1, 0)) %>%
  mutate(testi.can = ifelse(testi.can <= 5, 1, 0)) %>%
  mutate(blood.can = ifelse(blood.can <= 5, 1, 0)) %>%
  mutate(thyroid.can = ifelse(thyroid.can <= 5, 1, 0)) %>%
  mutate(bone.can = ifelse(bone.can <= 5, 1, 0)) %>%
  mutate(uteri.can = ifelse(uteri.can <= 5, 1, 0)) %>%
  mutate(brain.can = ifelse(brain.can <= 5, 1, 0)) %>%
  mutate(other.can = ifelse(other.can <= 5, 1, 0)) %>%
  mutate(unk.can = ifelse(unk.can <= 5, 1, 0)) %>%
  mutate(breast.can = ifelse(breast.can <= 5, 1, 0)) %>%
  mutate(cervic.can = ifelse(cervic.can <= 5, 1, 0)) %>%
  mutate(colon.can = ifelse(colon.can <= 5, 1, 0)) %>%
  mutate(esoph.can = ifelse(esoph.can <= 5, 1, 0)) %>%
  mutate(gallblad.can = ifelse(gallblad.can <= 5, 1, 0)) %>%
  mutate(kidney.can = ifelse(kidney.can <= 5, 1, 0)) %>%
  mutate(larynx.can = ifelse(larynx.can <= 5, 1, 0)) %>%
  mutate(leukem.can = ifelse(leukem.can <= 5, 1, 0)) %>%
  mutate(liver.can = ifelse(liver.can <= 5, 1, 0)) %>%
  mutate(lung.can = ifelse(lung.can <= 5, 1, 0)) %>%
  mutate(lymph.can = ifelse(lymph.can <= 5, 1, 0)) %>%
  mutate(melano.can = ifelse(melano.can <= 5, 1, 0)) %>%
  mutate(mouth.can = ifelse(mouth.can <= 5, 1, 0)) %>%
  mutate(nerv.can = ifelse(nerv.can <= 5, 1, 0)) %>%
  mutate(ovari.can = ifelse(ovari.can <= 5, 1, 0)) %>%
  mutate(pancr.can = ifelse(pancr.can <= 5, 1, 0)) %>%
  mutate(prost.can = ifelse(prost.can <= 5, 1, 0)) %>%
  mutate(rectal.can = ifelse(rectal.can <= 5, 1, 0)) %>%
  mutate(non.mela.can = ifelse(non.mela.can <= 5, 1, 0)) %>%
  mutate(unk.skin.can = ifelse(unk.skin.can <= 5, 1, 0)) %>%
  mutate(soft.can = ifelse(soft.can <= 5, 1, 0)) %>%
  mutate(stomach.can = ifelse(stomach.can <= 5, 1, 0))

sum.cycle.13.14 <- cycle.13.14 %>%
   select(1, 52:82) %>%
   replace(is.na(.), 0) %>%
   mutate(cancer.recent = rowSums(.[2:32]))%>%
   mutate(cancer.recent = ifelse(cancer.recent >= 1, 1, 0)) %>%
   mutate(cancer.recent = factor(cancer.recent, levels=c(1, 0), labels = c("Yes",        "No"))) %>%
   select(1, 33)

cycle.13.14 <- left_join(cycle.13.14, sum.cycle.13.14, by="id")
 
rm(sum.cycle.13.14)


#2015-2016
cycle.15.16 <- cycle.15.16 %>%
  mutate(bladder.can = age - age.bladder.can) %>%
  mutate(testi.can = age - age.testi.can) %>%
  mutate(blood.can = age - age.blood.can) %>%
  mutate(thyroid.can = age - age.thyroid.can) %>%
  mutate(bone.can = age - age.bone.can) %>%
  mutate(uteri.can = age - age.uteri.can) %>%
  mutate(brain.can = age - age.brain.can) %>%
  mutate(other.can = age - age.other.can) %>%
  mutate(unk.can = age - age.unk.can) %>%
  mutate(breast.can = age - age.breast.can) %>%
  mutate(cervic.can = age - age.cervic.can) %>%
  mutate(colon.can = age - age.colon.can) %>%
  mutate(esoph.can = age - age.esoph.can) %>%
  mutate(gallblad.can = age - age.gallblad.can) %>%
  mutate(kidney.can = age - age.kidney.can) %>%
  mutate(larynx.can = age - age.larynx.can) %>%
  mutate(leukem.can = age - age.leukem.can) %>%
  mutate(liver.can = age - age.liver.can) %>%
  mutate(lung.can = age - age.lung.can) %>%
  mutate(lymph.can = age - age.lymph.can) %>%
  mutate(melano.can = age - age.melano.can) %>%
  mutate(mouth.can = age - age.mouth.can) %>%
  mutate(nerv.can = age - age.nerv.can) %>%
  mutate(ovari.can = age - age.ovari.can) %>%
  mutate(pancr.can = age - age.pancr.can) %>%
  mutate(prost.can = age - age.prost.can) %>%
  mutate(rectal.can = age - age.rectal.can) %>%
  mutate(non.mela.can = age - age.non.mela.can) %>%
  mutate(unk.skin.can = age - age.unk.skin.can) %>%
  mutate(soft.can = age - age.soft.can) %>%
  mutate(stomach.can = age - age.stomach.can) 

cycle.15.16[52:82] <- lapply(cycle.15.16[52:82], as.numeric)

cycle.15.16 <- cycle.15.16 %>%
  mutate(bladder.can = ifelse(bladder.can <= 5, 1, 0)) %>%
  mutate(testi.can = ifelse(testi.can <= 5, 1, 0)) %>%
  mutate(blood.can = ifelse(blood.can <= 5, 1, 0)) %>%
  mutate(thyroid.can = ifelse(thyroid.can <= 5, 1, 0)) %>%
  mutate(bone.can = ifelse(bone.can <= 5, 1, 0)) %>%
  mutate(uteri.can = ifelse(uteri.can <= 5, 1, 0)) %>%
  mutate(brain.can = ifelse(brain.can <= 5, 1, 0)) %>%
  mutate(other.can = ifelse(other.can <= 5, 1, 0)) %>%
  mutate(unk.can = ifelse(unk.can <= 5, 1, 0)) %>%
  mutate(breast.can = ifelse(breast.can <= 5, 1, 0)) %>%
  mutate(cervic.can = ifelse(cervic.can <= 5, 1, 0)) %>%
  mutate(colon.can = ifelse(colon.can <= 5, 1, 0)) %>%
  mutate(esoph.can = ifelse(esoph.can <= 5, 1, 0)) %>%
  mutate(gallblad.can = ifelse(gallblad.can <= 5, 1, 0)) %>%
  mutate(kidney.can = ifelse(kidney.can <= 5, 1, 0)) %>%
  mutate(larynx.can = ifelse(larynx.can <= 5, 1, 0)) %>%
  mutate(leukem.can = ifelse(leukem.can <= 5, 1, 0)) %>%
  mutate(liver.can = ifelse(liver.can <= 5, 1, 0)) %>%
  mutate(lung.can = ifelse(lung.can <= 5, 1, 0)) %>%
  mutate(lymph.can = ifelse(lymph.can <= 5, 1, 0)) %>%
  mutate(melano.can = ifelse(melano.can <= 5, 1, 0)) %>%
  mutate(mouth.can = ifelse(mouth.can <= 5, 1, 0)) %>%
  mutate(nerv.can = ifelse(nerv.can <= 5, 1, 0)) %>%
  mutate(ovari.can = ifelse(ovari.can <= 5, 1, 0)) %>%
  mutate(pancr.can = ifelse(pancr.can <= 5, 1, 0)) %>%
  mutate(prost.can = ifelse(prost.can <= 5, 1, 0)) %>%
  mutate(rectal.can = ifelse(rectal.can <= 5, 1, 0)) %>%
  mutate(non.mela.can = ifelse(non.mela.can <= 5, 1, 0)) %>%
  mutate(unk.skin.can = ifelse(unk.skin.can <= 5, 1, 0)) %>%
  mutate(soft.can = ifelse(soft.can <= 5, 1, 0)) %>%
  mutate(stomach.can = ifelse(stomach.can <= 5, 1, 0))

sum.cycle.15.16 <- cycle.15.16 %>%
   select(1, 52:82) %>%
   replace(is.na(.), 0) %>%
   mutate(cancer.recent = rowSums(.[2:32]))%>%
   mutate(cancer.recent = ifelse(cancer.recent >= 1, 1, 0)) %>%
   mutate(cancer.recent = factor(cancer.recent, levels=c(1, 0), labels = c("Yes",        "No"))) %>%
   select(1, 33)

cycle.15.16 <- left_join(cycle.15.16, sum.cycle.15.16, by="id")
 
rm(sum.cycle.15.16)


#2017-2018
cycle.17.18 <- cycle.17.18 %>%
  mutate(first.can = age - age.1st.can) %>%
  mutate(second.can = age - age.2nd.can) %>%
  mutate(third.can = age - age.3rd.can) 

cycle.17.18[23:25] <- lapply(cycle.17.18[23:25], as.numeric)

cycle.17.18 <- cycle.17.18 %>%
  mutate(first.can = ifelse(first.can <= 5, 1, 0)) %>%
  mutate(second.can = ifelse(second.can <= 5, 1, 0)) %>%
  mutate(third.can = ifelse(third.can <= 5, 1, 0)) 

sum.cycle.17.18 <- cycle.17.18 %>%
   select(1, 23:25) %>%
   replace(is.na(.), 0) %>%
   mutate(cancer.recent = rowSums(.[2:4]))%>%
   mutate(cancer.recent = ifelse(cancer.recent >= 1, 1, 0)) %>%
   mutate(cancer.recent = factor(cancer.recent, levels=c(1, 0), labels = c("Yes",        "No"))) %>%
   select(1, 5)

cycle.17.18 <- left_join(cycle.17.18, sum.cycle.17.18, by="id")
 
rm(sum.cycle.17.18)

```



Then, a combined data frame was generated containing all eligible participants from all cycle (2011-2012, 2013-2014, 2015-2016, and 2017-2018).  Eligible participants include those 40 years of age or older at the time of their NHANES interview.  This cut-off of 40 years of age or older was selecting because the preventive aspirin use questions (RXQASA) was only asked of participants in this age range. 

Importantly, this combined data frame is intended only for exploratory assessment of the unweighted population of study participants, and was not used for the weighted assessments.

```{r eval = TRUE, message = FALSE}

# Remove labels to facilitate combination of all cycle data frames

#2011-2012
cycle.11.12[c(2, 4, 7:41, 48:49)] <- lapply(cycle.11.12[c(2, 4, 7:41, 48:49)], as.integer)
cycle.11.12[c(1, 42)] <- lapply(cycle.11.12[c(1, 42)], as.character)
cycle.11.12[47] <- lapply(cycle.11.12[47], as.numeric)

#2013-2014
cycle.13.14[c(2, 4, 7:41, 48:49)] <- lapply(cycle.13.14[c(2, 4, 7:41, 48:49)], as.integer)
cycle.13.14[c(1, 42)] <- lapply(cycle.13.14[c(1, 42)], as.character)
cycle.13.14[47] <- lapply(cycle.13.14[47], as.numeric)

#2015-2016
cycle.15.16[c(2, 4, 7:41, 48:49)] <- lapply(cycle.15.16[c(2, 4, 7:41, 48:49)], as.integer)
cycle.15.16[c(1, 42)] <- lapply(cycle.15.16[c(1, 42)], as.character)
cycle.15.16[47] <- lapply(cycle.15.16[47], as.numeric)

#2017-2018
cycle.17.18[c(2, 4, 7:12, 19:20)] <- lapply(cycle.17.18[c(2, 4, 7:12, 19:20)], as.integer)
cycle.17.18[c(1, 13)] <- lapply(cycle.17.18[c(1, 13)], as.character)
cycle.17.18[18] <- lapply(cycle.17.18[18], as.numeric)


# Append rows of data frames for 2011-2012, 2013-2014, 2015-2016, and 2017-2018 cycles
all.cycles <- bind_rows(cycle.11.12, cycle.13.14, cycle.15.16, cycle.17.18)


# Change cycle name in combined data frame to specify years of each cycle
all.cycles <- all.cycles %>%
    mutate(cycle = factor(cycle, levels=c(7, 8, 9, 10), labels = c("2011-2012",           "2013-2014", "2015-2016", "2017-2018")))

# Create a data frame containing only those 40 years of age or older 
age.all.cycles <- filter(all.cycles, age > 39)

# Create a data frame containing only those 40 years of age or older with a history of cancer
can.age.all.cycles <- filter(all.cycles, age > 39 & hx.can == "Yes")

# Create a data frame containing only those 40 years of age or older with a history of recent cancer (based on aforementioned definition of recent cancer)
rcan.age.all.cycles <- filter(all.cycles, age > 39 & cancer.recent == "Yes")

```



The differences in antithrombotic use by cancer type will not be a focus of this project. However, in order to understand the distribution of cancer types being reported for use in developing future project in this area, a data frame was generated that listed all cancer types reported by participants (including multiple cancer types reported by a single participant). 

```{r eval = TRUE, message = FALSE}

# Create one column to encompass all cancer types reported by participants 

# 2011-2016
typecan.11.16 <- age.all.cycles %>%
  select(2, 7:10) %>%
  melt(id.var = c('cycle'), variable.name = 'can.type') 

# 2017-2018 (Combined separately from the 11-16 cycles because different variables were used for the 17-18 cycle to demarcate different versions of these questions used for the 17-18 cycle)
typecan.17.18 <- age.all.cycles %>%
  select(2, 84, 86, 88) %>%
  melt(id.var = c('cycle'), variable.name = 'can.type')


# Create a combined data frame of all cancer types across all cycles and label cancer types
typecan.all <- bind_rows(typecan.11.16, typecan.17.18) %>%
mutate(value = factor(value, levels=c(10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,   21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 66, 77, 99), labels = c("Bladder", "Blood", "Bone", "Brain", "Breast", "Cervix", "Colon",   "Esophagus", "Gallbladder", "Kidney", "Larynx/Windpipe", "Leukemia", "Liver",         "Lung", "Lymphoma/Hodgkin's Disease", "Melanoma", "Mouth/Tongue/Lip",                 "Nervous System", "Ovary", "Pancreas", "Prostate", "Rectum", "Skin (Non-Melanoma)",   "Skin (Kind Unknown)", "Soft Tissue", "Stomach", "Testis", "Thyroid", "Uterus",       "Other", "NA", "NA", "NA"))) %>%   
  filter(!is.na(value)) %>%   
  filter(value!="NA")                                          

rm(typecan.11.16, typecan.17.18)


# To facilitate review of the most common cancer types reported over all cycles, generate a data frame containing only cancer types reported 30 times or more across all cycles
table(typecan.all$value)

typecan.30orMore <- typecan.all%>%
  filter(value == "Bladder"|value == "Colon"|value == "Kidney"|value == "Melanoma"|     value == "Ovary"|value == "Thyroid"|value == "Breast"|value == "Lung"|value ==        "Skin (Non-Melanoma)"|value == "Uterus"|value == "Cervix"|value ==                    "Lymphoma/Hodgkin's Disease"|value == "Prostate"|value == "Skin (Kind Unknown)"|      value == "Other")

```


For generation of survey weights and Results output, all dichotomous yes/no variables will be re-leveled to make "No" the reference.

```{r eval = TRUE, message = FALSE}

# Relevel history of cancer, stroke, MI, and recent cancer, as well as anticoagulant use and preventative aspirin use for all cycles

# 2011-2012
cycle.11.12$hx.can <- relevel(cycle.11.12$hx.can, ref = "No")
cycle.11.12$hx.stroke <- relevel(cycle.11.12$hx.stroke, ref = "No")
cycle.11.12$hx.mi <- relevel(cycle.11.12$hx.mi, ref = "No")
cycle.11.12$anticoag <- relevel(cycle.11.12$anticoag, ref = "No")
cycle.11.12$aspirin.any <- relevel(cycle.11.12$aspirin.any, ref = "No")
cycle.11.12$cancer.recent <- relevel(cycle.11.12$cancer.recent, ref = "No")

# 2013-2014
cycle.13.14$hx.can <- relevel(cycle.13.14$hx.can, ref = "No")
cycle.13.14$hx.stroke <- relevel(cycle.13.14$hx.stroke, ref = "No")
cycle.13.14$hx.mi <- relevel(cycle.13.14$hx.mi, ref = "No")
cycle.13.14$anticoag <- relevel(cycle.13.14$anticoag, ref = "No")
cycle.13.14$aspirin.any <- relevel(cycle.13.14$aspirin.any, ref = "No")
cycle.13.14$cancer.recent <- relevel(cycle.13.14$cancer.recent, ref = "No")

# 2015-2016
cycle.15.16$hx.can <- relevel(cycle.15.16$hx.can, ref = "No")
cycle.15.16$hx.stroke <- relevel(cycle.15.16$hx.stroke, ref = "No")
cycle.15.16$hx.mi <- relevel(cycle.15.16$hx.mi, ref = "No")
cycle.15.16$anticoag <- relevel(cycle.15.16$anticoag, ref = "No")
cycle.15.16$aspirin.any <- relevel(cycle.15.16$aspirin.any, ref = "No")
cycle.15.16$cancer.recent <- relevel(cycle.15.16$cancer.recent, ref = "No")

# 2017-2018
cycle.17.18$hx.can <- relevel(cycle.17.18$hx.can, ref = "No")
cycle.17.18$hx.stroke <- relevel(cycle.17.18$hx.stroke, ref = "No")
cycle.17.18$hx.mi <- relevel(cycle.17.18$hx.mi, ref = "No")
cycle.17.18$anticoag <- relevel(cycle.17.18$anticoag, ref = "No")
cycle.17.18$aspirin.any <- relevel(cycle.17.18$aspirin.any, ref = "No")
cycle.17.18$cancer.recent <- relevel(cycle.17.18$cancer.recent, ref = "No")

```



## Survey Weights

NHANES is a complex, multistage, probability sample. Thus, in order to generate estimates that are representative of the U.S. civilian non-institutionalized population, weighting must be used to account for the complex survey design elements (e.g. oversampling), survey non-response, and post-stratification adjustment.  Survey weights and design elements for each cycle were specified using the 'survey' package. Additionally, taking these specified survey weights and design elements into account, variables for subsetting were generated for each cycle to allow for analysis of only: the subpopulation of participants 40 years of age or older, the subpopulation of participants 40 years of age or older with a history of cancer, the subpopulation of participants 40 years of age or older with a recent history of cancer (based on the aforementioned definition of recent cancer), the subpopulation of participants between 40 years of age and 60 years of age, the subpopulation of participants 61 years of age or older, the subpopulation of participants between 40 years of age and 60 years of age with a history of cancer, the subpopulation of participants 61 years of age or older with a history of cancer, the subpopulation of participants 40 years of age or older with a history of stroke, and the subpopulation of participants 40 years of age or older with a history of myocardial infarction (MI). 

```{r eval = TRUE, message = FALSE}

# Use 'svydesign' (from 'survey') to assign the weights/design elements of NHANES

#2011-2012
svydesign.11.12 <- svydesign(id = ~psu,
                      strata  = ~strata,
                      weights = ~int.weight,
                      nest    = TRUE,
                      survey.lonely.psu = "adjust",
                      data    = cycle.11.12)

summary(svydesign.11.12)


#2013-2014
svydesign.13.14 <- svydesign(id = ~psu,
                      strata  = ~strata,
                      weights = ~int.weight,
                      nest    = TRUE,
                      survey.lonely.psu = "adjust",
                      data    = cycle.13.14)
summary(svydesign.13.14)


#2015-2016
svydesign.15.16 <- svydesign(id = ~psu,
                      strata  = ~strata,
                      weights = ~int.weight,
                      nest    = TRUE,
                      survey.lonely.psu = "adjust",
                      data    = cycle.15.16)
summary(svydesign.15.16)


#2017-2018
svydesign.17.18 <- svydesign(id = ~psu,
                      strata  = ~strata,
                      weights = ~int.weight,
                      nest    = TRUE,
                      survey.lonely.psu = "adjust",
                      data    = cycle.17.18)
summary(svydesign.17.18)



# Subset to those 40 years of age or older 

#2011-2012
age.design.11.12 <- subset(svydesign.11.12, age > 39)
summary(age.design.11.12)

#2013-2014
age.design.13.14 <- subset(svydesign.13.14, age > 39)
summary(age.design.13.14)

#2015-2016
age.design.15.16 <- subset(svydesign.15.16, age > 39)
summary(age.design.15.16)

#2017-2018
age.design.17.18 <- subset(svydesign.17.18, age > 39)
summary(age.design.17.18)



# Subset to those 40 years of age or older with a history of cancer

#2011-2012
can.age.design.11.12 <- subset(svydesign.11.12, age > 39 & hx.can == "Yes")
summary(can.age.design.11.12)

#2013-2014
can.age.design.13.14 <- subset(svydesign.13.14, age > 39 & hx.can == "Yes")
summary(can.age.design.13.14)

#2015-2016
can.age.design.15.16 <- subset(svydesign.15.16, age > 39 & hx.can == "Yes")
summary(can.age.design.15.16)

#2017-2018
can.age.design.17.18 <- subset(svydesign.17.18, age > 39 & hx.can == "Yes")
summary(can.age.design.17.18)



# Subset to those 40 years of age or older with a recent history of cancer (based on aforementioned definition of recent cancer)

#2011-2012
rcan.age.design.11.12 <- subset(svydesign.11.12, age > 39 & cancer.recent == "Yes")
summary(rcan.age.design.11.12)

#2013-2014
rcan.age.design.13.14 <- subset(svydesign.13.14, age > 39 & cancer.recent == "Yes")
summary(rcan.age.design.13.14)

#2015-2016
rcan.age.design.15.16 <- subset(svydesign.15.16, age > 39 & cancer.recent == "Yes")
summary(rcan.age.design.15.16)

#2017-2018
rcan.age.design.17.18 <- subset(svydesign.17.18, age > 39 & cancer.recent == "Yes")
summary(rcan.age.design.17.18)



# Subset to those between 40 years of age and 60 years of age with or without a history of cancer

#2011-2012
gp1.age.design.11.12 <- subset(svydesign.11.12, age > 39 & age < 61)
summary(gp1.age.design.11.12)

#2013-2014
gp1.age.design.13.14 <- subset(svydesign.13.14, age > 39 & age < 61)
summary(gp1.age.design.13.14)

#2015-2016
gp1.age.design.15.16 <- subset(svydesign.15.16, age > 39 & age < 61)
summary(gp1.age.design.15.16)

#2017-2018
gp1.age.design.17.18 <- subset(svydesign.17.18, age > 39 & age < 61)
summary(gp1.age.design.17.18)



# Subset to those 61 years of age or greater with or without a history of cancer

#2011-2012
gp2.age.design.11.12 <- subset(svydesign.11.12, age > 60)
summary(gp2.age.design.11.12)

#2013-2014
gp2.age.design.13.14 <- subset(svydesign.13.14, age > 60)
summary(gp2.age.design.13.14)

#2015-2016
gp2.age.design.15.16 <- subset(svydesign.15.16, age > 60)
summary(gp2.age.design.15.16)

#2017-2018
gp2.age.design.17.18 <- subset(svydesign.17.18, age > 60)
summary(gp2.age.design.17.18)



# Subset to those between 40 years of age and 60 years of age with a history of cancer

#2011-2012
gp1.can.age.design.11.12 <- subset(svydesign.11.12, age > 39 & age < 61 & hx.can == "Yes")
summary(gp1.can.age.design.11.12)

#2013-2014
gp1.can.age.design.13.14 <- subset(svydesign.13.14, age > 39 & age < 61 & hx.can == "Yes")
summary(gp1.can.age.design.13.14)

#2015-2016
gp1.can.age.design.15.16 <- subset(svydesign.15.16, age > 39 & age < 61 & hx.can == "Yes")
summary(gp1.can.age.design.15.16)

#2017-2018
gp1.can.age.design.17.18 <- subset(svydesign.17.18, age > 39 & age < 61 & hx.can == "Yes")
summary(gp1.can.age.design.17.18)



# Subset to those 61 years of age or greater with a history of cancer

#2011-2012
gp2.can.age.design.11.12 <- subset(svydesign.11.12, age > 60 & hx.can == "Yes")
summary(gp2.can.age.design.11.12)

#2013-2014
gp2.can.age.design.13.14 <- subset(svydesign.13.14, age > 60 & hx.can == "Yes")
summary(gp2.can.age.design.13.14)

#2015-2016
gp2.can.age.design.15.16 <- subset(svydesign.15.16, age > 60 & hx.can == "Yes")
summary(gp2.can.age.design.15.16)

#2017-2018
gp2.can.age.design.17.18 <- subset(svydesign.17.18, age > 60 & hx.can == "Yes")
summary(gp2.can.age.design.17.18)



# Subset to those 40 years of age or older with a history of stroke

#2011-2012
str.age.design.11.12 <- subset(svydesign.11.12, age > 39 & hx.stroke == "Yes")
summary(str.age.design.11.12)

#2013-2014
str.age.design.13.14 <- subset(svydesign.13.14, age > 39 & hx.stroke == "Yes")
summary(str.age.design.13.14)

#2015-2016
str.age.design.15.16 <- subset(svydesign.15.16, age > 39 & hx.stroke == "Yes")
summary(str.age.design.15.16)

#2017-2018
str.age.design.17.18 <- subset(svydesign.17.18, age > 39 & hx.stroke == "Yes")
summary(str.age.design.17.18)



# Subset to those 40 years of age or older with a history of myocardial infarction (MI)

#2011-2012
mi.age.design.11.12 <- subset(svydesign.11.12, age > 39 & hx.mi == "Yes")
summary(mi.age.design.11.12)

#2013-2014
mi.age.design.13.14 <- subset(svydesign.13.14, age > 39 & hx.mi == "Yes")
summary(mi.age.design.13.14)

#2015-2016
mi.age.design.15.16 <- subset(svydesign.15.16, age > 39 & hx.mi == "Yes")
summary(mi.age.design.15.16)

#2017-2018
mi.age.design.17.18 <- subset(svydesign.17.18, age > 39 & hx.mi == "Yes")
summary(mi.age.design.17.18)

```




# Results


First, the unweighted characteristics of the study populations will be examined, including the characteristics of the overall population 40 years of age or older from NHANES cycles 2011-2018 (Table 1), the characteristics of the population 40 years of age or older with a history of cancer from NHANES cycles 2011-2018 (Table 2), and the characteristics of the population 40 years of age or older with a history of recent cancer from NHANES cycles 2011-2018 (Table 3).

```{r eval = TRUE, message = FALSE}

#Label variables for inclusion in Table 1
label(age.all.cycles$gender)  <- "Gender"
label(age.all.cycles$age)  <- "Age"
label(age.all.cycles$race)  <- "Race"
label(age.all.cycles$hx.can)  <- "History of Cancer"
label(age.all.cycles$hx.stroke)  <- "History of Stroke"
label(age.all.cycles$hx.mi)  <- "History of Myocardial Infarction"
label(age.all.cycles$aspirin.any)  <- "Preventative Aspirin Use"
label(age.all.cycles$anticoag)  <- "Anticoagulant Use"

#Generate Table 1. Unweighted Characteristics Among Those 40 Years of Age or Older, NHANES 2011-2018
table1(~ gender + age + race + hx.can + hx.stroke + hx.mi + aspirin.any + anticoag | cycle, data=age.all.cycles, overall="Total", caption= "Table 1. Unweighted Characteristics Among Those 40 Years of Age or Older, NHANES 2011-2018")


```




```{r eval = TRUE, message = FALSE}

#Label variables for inclusion in Table 2
label(can.age.all.cycles$gender)  <- "Gender"
label(can.age.all.cycles$age)  <- "Age"
label(can.age.all.cycles$race)  <- "Race"
label(can.age.all.cycles$hx.stroke)  <- "History of Stroke"
label(can.age.all.cycles$hx.mi)  <- "History of Myocardial Infarction"
label(can.age.all.cycles$aspirin.any)  <- "Preventative Aspirin Use"
label(can.age.all.cycles$anticoag)  <- "Anticoagulant Use"

#Generate Table 2. Unweighted Characteristics Among Those 40 Years of Age or Older With a History of Cancer, NHANES 2011-2018
table1(~ gender + age + race + hx.stroke + hx.mi + aspirin.any + anticoag | cycle, data=can.age.all.cycles, overall="Total", caption= "Table 2. Unweighted Characteristics Among Those 40 Years of Age or Older With a History of Cancer, NHANES 2011-2018")

```




```{r eval = TRUE, message = FALSE}

#Label variables for inclusion in Table 3
label(rcan.age.all.cycles$gender)  <- "Gender"
label(rcan.age.all.cycles$age)  <- "Age"
label(rcan.age.all.cycles$race)  <- "Race"
label(rcan.age.all.cycles$hx.stroke)  <- "History of Stroke"
label(rcan.age.all.cycles$hx.mi)  <- "History of Myocardial Infarction"
label(rcan.age.all.cycles$aspirin.any)  <- "Preventative Aspirin Use"
label(rcan.age.all.cycles$anticoag)  <- "Anticoagulant Use"

#Generate Table 3. Unweighted Characteristics Among Those 40 Years of Age or Older With a Recent History of Cancer, NHANES 2011-2018
table1(~ gender + age + race + hx.stroke + hx.mi + aspirin.any + anticoag | cycle, data=rcan.age.all.cycles, overall="Total", caption= "Table 3. Unweighted Characteristics Among Those 40 Years of Age or Older With a Recent History of Cancer, NHANES 2011-2018")

```

**Analysis of Tables 1-3:** Tables 1-3 provide a general understanding of the study populations prior to weighting. Compared to the overall population, the groups with a history of cancer and a recent history of cancer have a consistently greater median age (by approximately 10 years), a consistently greater proportion of the population being white, a consistently greater proportion with a history of stroke or MI, and a consistently greater proportion with preventative aspirin or anticoagulant use. While these observations are not unexpected and are partially attributable to the NHANES sampling strategies, they have important implications for the interpretation of subsequent weighted assessments.


Next, the distribution of cancer types among those with a reported history of cancer were explored.

```{r eval = TRUE, message = FALSE}

# Reverse the order of the 'value' variable (in 'typecan.30orMore' data frame) to allow cancer types to be alphabetically listed when graphed on a vertical axis
typecan.30orMore$value <- forcats::fct_rev(typecan.30orMore$value) 

#Generate Figure 1. Unweighted Cancer Types, NHANES 2011-2018
ggplot(data = typecan.30orMore, aes(x = value, fill = cycle)) +
  geom_bar(color = "black")  + 
  scale_fill_jco() +
  scale_color_jco() + 
  theme_bw() + 
  coord_flip() + 
  labs(title = "Figure 1. Unweighted Cancer Types, NHANES 2011-2018*") + 
  xlab("Cancer Type") +
  ylab("Count") + 
  guides(fill=guide_legend(title="Cycle")) +
  labs(caption = "*Includes only cancer types reported 30 or more times among those 40 years of age or older")

```

**Analysis of Figure 1:** Figure 1 demonstrates that the majority of cancer histories reported over all cycles were either breast, colon, skin, or prostate cancers.


Then, the key characteristics of the study populations will be re-examined after accounting for the survey weights and design elements. Displayed below are the weighted characteristics of the overall population 40 years of age or older from NHANES cycles 2011-2018 (Table 4), and the weighted characteristics of the population 40 years of age or older with a history of cancer from NHANES cycles 2011-2018 (Table 5).

```{r eval = TRUE, message = FALSE}

# Calculate weighted numbers/proportions for key characteristics by cycle among those 40 years of age or older

# 2011-2012
svytable(~gender, design = age.design.11.12)
svyciprop(~I(gender=="Female"), age.design.11.12, method="likelihood")

svyquantile(~age, design = age.design.11.12, c(.25,.5,.75),ci=TRUE)

svytable(~hx.can, design = age.design.11.12)
svyciprop(~I(hx.can=="Yes"), age.design.11.12, method="likelihood")

svytable(~hx.stroke, design = age.design.11.12)
svyciprop(~I(hx.stroke=="Yes"), age.design.11.12, method="likelihood")

svytable(~aspirin.any, design = age.design.11.12)
svyciprop(~I(aspirin.any=="Yes"), age.design.11.12, method="likelihood")

svytable(~anticoag, design = age.design.11.12)
svyciprop(~I(anticoag=="Yes"), age.design.11.12, method="likelihood")


# 2013-2014
svytable(~gender, design = age.design.13.14)
svyciprop(~I(gender=="Female"), age.design.13.14, method="likelihood")

svyquantile(~age, design = age.design.13.14, c(.25,.5,.75),ci=TRUE)

svytable(~hx.can, design = age.design.13.14)
svyciprop(~I(hx.can=="Yes"), age.design.13.14, method="likelihood")

svytable(~hx.stroke, design = age.design.13.14)
svyciprop(~I(hx.stroke=="Yes"), age.design.13.14, method="likelihood")

svytable(~aspirin.any, design = age.design.13.14)
svyciprop(~I(aspirin.any=="Yes"), age.design.13.14, method="likelihood")

svytable(~anticoag, design = age.design.13.14)
svyciprop(~I(anticoag=="Yes"), age.design.13.14, method="likelihood")


# 2015-2016
svytable(~gender, design = age.design.15.16)
svyciprop(~I(gender=="Female"), age.design.15.16, method="likelihood")

svyquantile(~age, design = age.design.15.16, c(.25,.5,.75),ci=TRUE)

svytable(~hx.can, design = age.design.15.16)
svyciprop(~I(hx.can=="Yes"), age.design.15.16, method="likelihood")

svytable(~hx.stroke, design = age.design.15.16)
svyciprop(~I(hx.stroke=="Yes"), age.design.15.16, method="likelihood")

svytable(~aspirin.any, design = age.design.15.16)
svyciprop(~I(aspirin.any=="Yes"), age.design.15.16, method="likelihood")

svytable(~anticoag, design = age.design.15.16)
svyciprop(~I(anticoag=="Yes"), age.design.15.16, method="likelihood")


# 2017-2018
svytable(~gender, design = age.design.17.18)
svyciprop(~I(gender=="Female"), age.design.17.18, method="likelihood")

svyquantile(~age, design = age.design.17.18, c(.25,.5,.75),ci=TRUE)

svytable(~hx.can, design = age.design.17.18)
svyciprop(~I(hx.can=="Yes"), age.design.17.18, method="likelihood")

svytable(~hx.stroke, design = age.design.17.18)
svyciprop(~I(hx.stroke=="Yes"), age.design.17.18, method="likelihood")

svytable(~aspirin.any, design = age.design.17.18)
svyciprop(~I(aspirin.any=="Yes"), age.design.17.18, method="likelihood")

svytable(~anticoag, design = age.design.17.18)
svyciprop(~I(anticoag=="Yes"), age.design.17.18, method="likelihood")



# Generate a weighted table of key characteristics by cycle among those 40 years of age or older

table4 <- read.table(header=TRUE, text='
"Characteristics" "2011-2012" "2013-2014" "2015-2016" "2017-2018" 
N 142,761,158 146,135,121 149,646,377 152,470,957
"Gender (Female) (%, CI)" "75,420,914 (52.8, 50.2-55.0)" "77,120,034 (52.8, 51.3-54.0)" "78,964,694 (52.8, 51.1-54.0)" "80,444,649 (52.8, 50.9-55.0)"
"Median Age (CI)" "56 (56-57)" "57 (56-58)" "57 (56-59)" "58 (57-60)" 
"Age IQR (CI)" "48 (47-49) - 65 (65-67)" "48 (47-49) - 66 (65-68)" "49 (48-50) - 67 (66-69)" "49 (48-50) - 68 (67-69)"
"History of Cancer (%, CI)" "20,572,454 (14.4, 12.8-16.0)" "23,216,331 (15.9, 14.6-17.0)" "24,384,596 (16.3, 15.1-18.0)" "24,388,993 (16.0, 14.1-18.0)"
"History of Stroke (%, CI)" "5,971,904 (4.19, 3.32-5.00)" "6,351,194 (4.35, 3.75-5.00)" "5,987,376 (4.01, 3.43-5.00)" "7,786,509 (5.11, 4.09-6.00)"
"Preventative Aspirin Use (%, CI)" "45,955,142 (32.2, 29.3-35.0)" "43,366,841 (29.7, 27.9-31.0)" "44,924,282 (30.0, 27.2-33.0)" "45,777,144 (30.0, 26.7-34.0)" 
"Anticoagulant Use (%, CI)" "3,450,309 (2.42, 1.82-3.00)" "4,265,214 (2.92, 2.46  3.00)" "4,770,723 (3.19, 2.32-4.00)" "5,254,937 (3.45, 2.54-5.00)"
')

table4 <- rename(table4, "2011-2012" = "X2011.2012", "2013-2014" = "X2013.2014", "2015-2016" = "X2015.2016", "2017-2018" = "X2017.2018")

kbl(table4, caption = "Table 4. Weighted Key Characteristics Among Those 40 Years of Age or Older, NHANES 2011-2018", booktabs = T) %>%
kable_styling(latex_options = c("striped", "hold_position")) %>%
  kable_styling(font_size = 18)

```




```{r eval = TRUE, message = FALSE}

# Calculate weighted numbers/proportions for key characteristics by cycle among those 40 years of age or older with a history of cancer

# 2011-2012
svytable(~gender, design = can.age.design.11.12)
svyciprop(~I(gender=="Female"), can.age.design.11.12, method="likelihood")

svyquantile(~age, design = can.age.design.11.12, c(.25,.5,.75),ci=TRUE)

svytable(~cancer.recent, design = can.age.design.11.12)
svyciprop(~I(cancer.recent=="Yes"), can.age.design.11.12, method="likelihood")

svytable(~hx.stroke, design = can.age.design.11.12)
svyciprop(~I(hx.stroke=="Yes"), can.age.design.11.12, method="likelihood")

svytable(~aspirin.any, design = can.age.design.11.12)
svyciprop(~I(aspirin.any=="Yes"), can.age.design.11.12, method="likelihood")

svytable(~anticoag, design = can.age.design.11.12)
svyciprop(~I(anticoag=="Yes"), can.age.design.11.12, method="likelihood")


# 2013-2014
svytable(~gender, design = can.age.design.13.14)
svyciprop(~I(gender=="Female"), can.age.design.13.14, method="likelihood")

svyquantile(~age, design = can.age.design.13.14, c(.25,.5,.75),ci=TRUE)

svytable(~cancer.recent, design = can.age.design.13.14)
svyciprop(~I(cancer.recent=="Yes"), can.age.design.13.14, method="likelihood")

svytable(~hx.stroke, design = can.age.design.13.14)
svyciprop(~I(hx.stroke=="Yes"), can.age.design.13.14, method="likelihood")

svytable(~aspirin.any, design = can.age.design.13.14)
svyciprop(~I(aspirin.any=="Yes"), can.age.design.13.14, method="likelihood")

svytable(~anticoag, design = can.age.design.13.14)
svyciprop(~I(anticoag=="Yes"), can.age.design.13.14, method="likelihood")


# 2015-2016
svytable(~gender, design = can.age.design.15.16)
svyciprop(~I(gender=="Female"), can.age.design.15.16, method="likelihood")

svyquantile(~age, design = can.age.design.15.16, c(.25,.5,.75),ci=TRUE)

svytable(~cancer.recent, design = can.age.design.15.16)
svyciprop(~I(cancer.recent=="Yes"), can.age.design.15.16, method="likelihood")

svytable(~hx.stroke, design = can.age.design.15.16)
svyciprop(~I(hx.stroke=="Yes"), can.age.design.15.16, method="likelihood")

svytable(~aspirin.any, design = can.age.design.15.16)
svyciprop(~I(aspirin.any=="Yes"), can.age.design.15.16, method="likelihood")

svytable(~anticoag, design = can.age.design.15.16)
svyciprop(~I(anticoag=="Yes"), can.age.design.15.16, method="likelihood")


# 2017-2018
svytable(~gender, design = can.age.design.17.18)
svyciprop(~I(gender=="Female"), can.age.design.17.18, method="likelihood")

svyquantile(~age, design = can.age.design.17.18, c(.25,.5,.75),ci=TRUE)

svytable(~cancer.recent, design = can.age.design.17.18)
svyciprop(~I(cancer.recent=="Yes"), can.age.design.17.18, method="likelihood")

svytable(~hx.stroke, design = can.age.design.17.18)
svyciprop(~I(hx.stroke=="Yes"), can.age.design.17.18, method="likelihood")

svytable(~aspirin.any, design = can.age.design.17.18)
svyciprop(~I(aspirin.any=="Yes"), can.age.design.17.18, method="likelihood")

svytable(~anticoag, design = can.age.design.17.18)
svyciprop(~I(anticoag=="Yes"), can.age.design.17.18, method="likelihood")



# Generate a weighted table of key characteristics by cycle among those 40 years of age or older with a history of cancer

table5 <- read.table(header=TRUE, text='
"Characteristics" "2011-2012" "2013-2014" "2015-2016" "2017-2018" 
N 20,572,454 23,216,330 24,384,596 24,388,993
"Gender (Female) (%, CI)" "11,542,765 (56.1, 49.4-63.0)" "12,531,914(54.0, 50.0-58.0)" "13,149,639 (53.9, 47.4-60.0)" "14,204,737 (58.2, 51.6-65.0)"
"Median Age (CI)" "64 (62-67)" "66 (63-68)" "68 (65-70)" "67 (64-71)"
"Age IQR (CI)" "54 (53-57) - 75 (73-78)" "57 (56-59) - 75 (72-78)" "58 (55-61) - 76 (74-78)" "60 (56-61) - 77 (75-79)"
"Recent History of Cancer (%, CI)" "9,322,639 (45.3, 37.4-53.0)" "9,938,718 (42.8, 36.9-49.0)" "8,937,992 (36.7, 29.7-44.0)" "10,485,099 (43.0, 36.0-50.0)"
"History of Stroke (%, CI)" "1,068,081 (5.19, 2.95-8.00)" "1,494,842 (6.45, 4.30-9.00)" "1,472,187 (6.04, 3.62-9.00)" "2,253,775 (9.24, 5.40-14.0)"
"Preventative Aspirin Use (%, CI)" "8,984,750 (43.7, 37.0-51.0)" "10,784,898 (46.5, 41.7-51.0)" "9,872,500 (40.5, 34.4-47.0)" "9,808,892 (40.2, 32.8-48.0)"
"Anticoagulant Use (%, CI)" "826,752.3 (4.02, 1.76-8.00)" "916,788.9 (3.95, 2.42-6.00)" "1,739,544 (7.13, 4.76-10.0)" "1,905,493 (7.81, 4.94-12.0)"
')

table5 <- rename(table5, "2011-2012" = "X2011.2012", "2013-2014" = "X2013.2014", "2015-2016" = "X2015.2016", "2017-2018" = "X2017.2018")

kbl(table5, caption = "Table 5. Weighted Key Characteristics Among Those 40 Years of Age or Older With a History of Cancer, NHANES 2011-2018", booktabs = T) %>%
kable_styling(latex_options = c("striped", "hold_position")) %>%
  kable_styling(font_size = 18)

```

**Analysis of Tables 4-5:** Tables 4 and 5 provide a general understanding of the study populations following weighting. Compared to the overall population, the group with a history of cancer has a consistently greater proportion of the population being female, a consistently greater median age (by approximately 10 years), a consistently greater proportion with a history of stroke, and a consistently greater proportion with preventative aspirin or anticoagulant use.



Then, trends in preventative aspirin use by cancer history were assessed across the 2011-2018 NHANES cycles. (Note: The "likelihood" method was used for estimating the confidence intervals for proportions for this and all subsequent weighted assessments. This method uses "the (Rao-Scott) scaled chi-squared distribution for the loglikelihood from a binomial distribution", and has been validated as an accurate method for estimation.[8])

```{r eval = TRUE, message = FALSE}

# Assess the weighted proportion of preventative aspirin users in each cycle among those 40 years of age or older with or without a history of cancer

# 2011-2012
svyciprop(~I(aspirin.any=="Yes"), age.design.11.12, method="likelihood")

# 2013-2014
svyciprop(~I(aspirin.any=="Yes"), age.design.13.14, method="likelihood")

# 2015-2016
svyciprop(~I(aspirin.any=="Yes"), age.design.15.16, method="likelihood")

# 2017-2018
svyciprop(~I(aspirin.any=="Yes"), age.design.17.18, method="likelihood")



# Assess the weighted proportion of preventative aspirin users in each cycle among those 40 years of age or older with a history of cancer

# 2011-2012
svyciprop(~I(aspirin.any=="Yes"), can.age.design.11.12, method="likelihood")

# 2013-2014
svyciprop(~I(aspirin.any=="Yes"), can.age.design.13.14, method="likelihood")

# 2015-2016
svyciprop(~I(aspirin.any=="Yes"), can.age.design.15.16, method="likelihood")

# 2017-2018
svyciprop(~I(aspirin.any=="Yes"), can.age.design.17.18, method="likelihood")



# Assess the weighted proportion of preventative aspirin users in each cycle among those 40 years of age or older with a recent history of cancer

# 2011-2012
svyciprop(~I(aspirin.any=="Yes"), rcan.age.design.11.12, method="likelihood")

# 2013-2014
svyciprop(~I(aspirin.any=="Yes"), rcan.age.design.13.14, method="likelihood")

# 2015-2016
svyciprop(~I(aspirin.any=="Yes"), rcan.age.design.15.16, method="likelihood")

# 2017-2018
svyciprop(~I(aspirin.any=="Yes"), rcan.age.design.17.18, method="likelihood")



# Generate a new Table from these Values (for use in generating Figure 2)
aspirin.trend <- read.table(header=TRUE, text='
cycle can.status prop.aspirin lower.CI upper.CI
2011-2012 "All" 32.2 29.3 35.0
2011-2012 "History of Cancer" 43.7 37.0 51.0
2011-2012 "Recent History of Cancer" 45.1 35.7 55.0
2013-2014 "All" 29.7 27.9 31.0
2013-2014 "History of Cancer" 46.5 41.7 51.0
2013-2014 "Recent History of Cancer" 39.0 31.6 47.0
2015-2016 "All" 30.0  27.2 33.0
2015-2016 "History of Cancer" 40.5 34.4 47.0
2015-2016 "Recent History of Cancer" 38.9 28.9 49.0
2017-2018 "All" 30.0 26.7 34.0
2017-2018 "History of Cancer" 40.2 32.8 48.0
2017-2018 "Recent History of Cancer" 38.3 26.7 51.0
')

aspirin.trend %>% 
  ggplot(aes(cycle, prop.aspirin, fill = can.status, group = can.status)) +
  geom_line(color = "black", size = 1) +
  geom_point(colour="black", pch=22, size = 3.6)  + 
  scale_fill_lancet() +
  scale_color_lancet() + 
  theme_bw() +
  geom_ribbon(data=aspirin.trend,aes(ymin=lower.CI,ymax=upper.CI),alpha=0.17) +
  labs(title = "Figure 2. Weighted Prevalence of Preventative Aspirin Use by Cancer History, NHANES 2011-2018*") + 
  xlab("Cycle") +
  ylab("Prevalence of Preventative Aspirin Use (%)") + 
  guides(fill=guide_legend(title="Cancer History")) +
  labs(caption = "*Includes only those 40 years of age or older")

```

**Analysis of Figure 2:** Figure 2 visually displays that across all cycles there is generally greater prevalence of preventative aspirin use among those with a history of cancer. Notably, while the relatively wide confidence intervals limit interpretation of the estimates from the population with a recent history of cancer, there appears to be between slightly less to no difference in preventative aspirin use based on a recent history of cancer diagnosis versus any history of cancer diagnosis. Among those with a history of cancer, there was a minor decrease in preventative aspirin use from 43.7% (37.0-51.0%) in 2011-2012 to 40.2% (32.8-48.0%) in 2017-2018.



Subsequently, trends in anticoagulant use by cancer history were assessed across the 2011-2018 NHANES cycles. 

```{r eval = TRUE, message = FALSE}

# Assess the weighted proportion of anticoagulant users in each cycle among those 40 years of age or older with or without a history of cancer

# 2011-2012
svyciprop(~I(anticoag=="Yes"), age.design.11.12, method="likelihood")

# 2013-2014
svyciprop(~I(anticoag=="Yes"), age.design.13.14, method="likelihood")

# 2015-2016
svyciprop(~I(anticoag=="Yes"), age.design.15.16, method="likelihood")

# 2017-2018
svyciprop(~I(anticoag=="Yes"), age.design.17.18, method="likelihood")



# Assess the weighted proportion of anticoagulant users in each cycle among those 40 years of age or older with a history of cancer

# 2011-2012
svyciprop(~I(anticoag=="Yes"), can.age.design.11.12, method="likelihood")

# 2013-2014
svyciprop(~I(anticoag=="Yes"), can.age.design.13.14, method="likelihood")

# 2015-2016
svyciprop(~I(anticoag=="Yes"), can.age.design.15.16, method="likelihood")

# 2017-2018
svyciprop(~I(anticoag=="Yes"), can.age.design.17.18, method="likelihood")



# Assess the weighted proportion of anticoagulant users in each cycle among those 40 years of age or older with a recent history of cancer

# 2011-2012
svyciprop(~I(anticoag=="Yes"), rcan.age.design.11.12, method="likelihood")

# 2013-2014
svyciprop(~I(anticoag=="Yes"), rcan.age.design.13.14, method="likelihood")

# 2015-2016
svyciprop(~I(anticoag=="Yes"), rcan.age.design.15.16, method="likelihood")

# 2017-2018
svyciprop(~I(anticoag=="Yes"), rcan.age.design.17.18, method="likelihood")



# Generate a new Table from these Values (for use in generating Figure 3)
anticoag.trend <- read.table(header=TRUE, text='
cycle can.status prop.anticoag lower.CI upper.CI
2011-2012 "All" 2.42 1.82 3.00
2011-2012 "History of Cancer" 4.02 1.76 8.00
2011-2012 "Recent History of Cancer" 2.61 0.21 10.0
2013-2014 "All" 2.92 2.46 3.00
2013-2014 "History of Cancer" 3.95 2.42 6.00
2013-2014 "Recent History of Cancer" 2.62 1.13 5.00
2015-2016 "All" 3.19 2.32 4.00
2015-2016 "History of Cancer" 7.13 4.76 10.0
2015-2016 "Recent History of Cancer" 7.68 3.66 14.0
2017-2018 "All" 3.45 2.54 5.00
2017-2018 "History of Cancer" 7.81 4.94 12.0
2017-2018 "Recent History of Cancer" 8.75 6.30 12.0
')

anticoag.trend %>% 
  ggplot(aes(cycle, prop.anticoag, fill = can.status, group = can.status)) +
  geom_line(color = "black", size = 1) +
  geom_point(colour="black", pch=22, size = 3.6)  + 
  scale_fill_lancet() +
  scale_color_lancet() + 
  theme_bw() +
  geom_ribbon(data=anticoag.trend,aes(ymin=lower.CI,ymax=upper.CI),alpha=0.17) +
  labs(title = "Figure 3. Weighted Prevalence of Anticoagulant Use by Cancer History, NHANES 2011-2018*") + 
  xlab("Cycle") +
  ylab("Prevalence of Anticoagulant Use (%)") + 
  guides(fill=guide_legend(title="Cancer History")) +
  labs(caption = "*Includes only those 40 years of age or older")

```

**Analysis of Figure 3:** While these findings suggest some increase in anticoagulant use among all study groups between the 2011-2012 to 2017-2018 cycles, Figure 3 illustrates that those with a history of cancer had a more sizable jump in anticoagulant use compared to the overall population. Although the relatively wide confidence intervals limit interpretation of the estimates from the population with a recent history of cancer, there appears to be minimal difference in anticoagulant use based on a recent history of cancer diagnosis versus any history of cancer diagnosis. Among those with a history of cancer, there was a rise in anticoagulant use from 4.02% (1.76-8.00%) in 2011-2012 to 7.81% (4.94-12.0%) in 2017-2018. Based on the timing of this increase, it may be associated with the introduction of new direct-acting oral anticoagulants (DOACs) into the market, and numerous trials supporting the safety and efficacy of these drugs.



Trends in preventative aspirin use among the overall population and the population with a history of cancer were then stratified by age (those between 40-60 years of age versus those older than 60 years of age), and re-graphed across the 2011-2018 NHANES cycles.

```{r eval = TRUE, message = FALSE}

# Assess the weighted proportion of preventative aspirin users in each cycle among those 40 years of age to 60 years of age with or without a history of cancer

# 2011-2012
svyciprop(~I(aspirin.any=="Yes"), gp1.age.design.11.12, method="likelihood")

# 2013-2014
svyciprop(~I(aspirin.any=="Yes"), gp1.age.design.13.14, method="likelihood")

# 2015-2016
svyciprop(~I(aspirin.any=="Yes"), gp1.age.design.15.16, method="likelihood")

# 2017-2018
svyciprop(~I(aspirin.any=="Yes"), gp1.age.design.17.18, method="likelihood")



# Assess the weighted proportion of preventative aspirin users in each cycle among those 61 years of age or older with or without a history of cancer

# 2011-2012
svyciprop(~I(aspirin.any=="Yes"), gp2.age.design.11.12, method="likelihood")

# 2013-2014
svyciprop(~I(aspirin.any=="Yes"), gp2.age.design.13.14, method="likelihood")

# 2015-2016
svyciprop(~I(aspirin.any=="Yes"), gp2.age.design.15.16, method="likelihood")

# 2017-2018
svyciprop(~I(aspirin.any=="Yes"), gp2.age.design.17.18, method="likelihood")



# Assess the weighted proportion of preventative aspirin users in each cycle among those 40 years of age to 60 years of age with a history of cancer

# 2011-2012
svyciprop(~I(aspirin.any=="Yes"), gp1.can.age.design.11.12, method="likelihood")

# 2013-2014
svyciprop(~I(aspirin.any=="Yes"), gp1.can.age.design.13.14, method="likelihood")

# 2015-2016
svyciprop(~I(aspirin.any=="Yes"), gp1.can.age.design.15.16, method="likelihood")

# 2017-2018
svyciprop(~I(aspirin.any=="Yes"), gp1.can.age.design.17.18, method="likelihood")



# Assess the weighted proportion of preventative aspirin users in each cycle among those 61 years of age or older with a history of cancer

# 2011-2012
svyciprop(~I(aspirin.any=="Yes"), gp2.can.age.design.11.12, method="likelihood")

# 2013-2014
svyciprop(~I(aspirin.any=="Yes"), gp2.can.age.design.13.14, method="likelihood")

# 2015-2016
svyciprop(~I(aspirin.any=="Yes"), gp2.can.age.design.15.16, method="likelihood")

# 2017-2018
svyciprop(~I(aspirin.any=="Yes"), gp2.can.age.design.17.18, method="likelihood")



# Generate a new Table from these Values (for use in generating Figure 4)
gp1gp2.aspirin.trend <- read.table(header=TRUE, text='
cycle can.age.status prop.aspirin lower.CI upper.CI
2011-2012 "All (Age 40-60)" 22.5 19.3 26.0
2011-2012 "All (Age 61+)" 48.2 44.5 52.0
2011-2012 "History of Cancer (Age 40-60)" 24.9 13.5 39.0
2011-2012 "History of Cancer (Aged 61+)" 55.6 49.5 62.0
2013-2014 "All (Age 40-60)" 17.7 15.3 20.0
2013-2014 "All (Age 61+)" 48.0 45.8 50.0
2013-2014 "History of Cancer (Age 40-60)" 28.5 21.1 37.0
2013-2014 "History of Cancer (Aged 61+)" 56.3 51.9 61.0
2015-2016 "All (Age 40-60)" 17.3 15.3 19.0
2015-2016 "All (Age 61+)" 48.4 44.0 53.0
2015-2016 "History of Cancer (Age 40-60)" 17.1 9.24 27.0
2015-2016 "History of Cancer (Aged 61+)" 50.1 43.5 57.0
2017-2018 "All (Age 40-60)" 18.6 15.5 22.0
2017-2018 "All (Age 61+)" 45.2 40.3 50.0
2017-2018 "History of Cancer (Age 40-60)" 17.6 9.06 29.0
2017-2018 "History of Cancer (Aged 61+)" 48.7 39.6 58.0
')

gp1gp2.aspirin.trend %>% 
  ggplot(aes(cycle, prop.aspirin, fill = can.age.status, group = can.age.status)) +
  geom_line(color = "black", size = 1) +
  geom_point(colour="black", pch=22, size = 3.6)  + 
  scale_fill_jama() +
  scale_color_jama() + 
  theme_bw() +
  geom_ribbon(data=gp1gp2.aspirin.trend,aes(ymin=lower.CI,ymax=upper.CI),alpha=0.2)   +
  labs(title = "Figure 4. Weighted Prevalence of Preventative Aspirin Use by Cancer History and Age Group, NHANES 2011-2018") + 
  xlab("Cycle") +
  ylab("Prevalence of Preventative Aspirin Use (%)") + 
  guides(fill=guide_legend(title="Cancer History and Age Group")) 

```

**Analysis of Figure 4:** Figure 4 suggests that the observed differences in preventative aspirin use between the overall population and those with a history of cancer (Figure 2) may be largely attributable to the population with a history of cancer being consistently older than the overall population (as stratifying by age removes a substantial amount of the difference in preventative aspirin use between these populations).


Trends in anticoagulant use among the overall population and the population with a history of cancer were then stratified by age (those between 40-60 years of age versus those older than 60 years of age), and re-graphed across the 2011-2018 NHANES cycles.

```{r eval = TRUE, message = FALSE}

# Assess the weighted proportion of anticoagulant users in each cycle among those 40 years of age to 60 years of age with or without a history of cancer

# 2011-2012
svyciprop(~I(anticoag=="Yes"), gp1.age.design.11.12, method="likelihood")

# 2013-2014
svyciprop(~I(anticoag=="Yes"), gp1.age.design.13.14, method="likelihood")

# 2015-2016
svyciprop(~I(anticoag=="Yes"), gp1.age.design.15.16, method="likelihood")

# 2017-2018
svyciprop(~I(anticoag=="Yes"), gp1.age.design.17.18, method="likelihood")



# Assess the weighted proportion of anticoagulant users in each cycle among those 61 years of age or older with or without a history of cancer

# 2011-2012
svyciprop(~I(anticoag=="Yes"), gp2.age.design.11.12, method="likelihood")

# 2013-2014
svyciprop(~I(anticoag=="Yes"), gp2.age.design.13.14, method="likelihood")

# 2015-2016
svyciprop(~I(anticoag=="Yes"), gp2.age.design.15.16, method="likelihood")

# 2017-2018
svyciprop(~I(anticoag=="Yes"), gp2.age.design.17.18, method="likelihood")



# Assess the weighted proportion of anticoagulant users in each cycle among those 40 years of age to 60 years of age with a history of cancer

# 2011-2012
#(Omitted: Original fit had not converged) svyciprop(~I(anticoag=="Yes"), gp1.can.age.design.11.12, method="likelihood")

# 2013-2014
svyciprop(~I(anticoag=="Yes"), gp1.can.age.design.13.14, method="likelihood")

# 2015-2016
svyciprop(~I(anticoag=="Yes"), gp1.can.age.design.15.16, method="likelihood")

# 2017-2018
svyciprop(~I(anticoag=="Yes"), gp1.can.age.design.17.18, method="likelihood")



# Assess the weighted proportion of anticoagulant users in each cycle among those 61 years of age or older with a history of cancer

# 2011-2012
svyciprop(~I(anticoag=="Yes"), gp2.can.age.design.11.12, method="likelihood")

# 2013-2014
svyciprop(~I(anticoag=="Yes"), gp2.can.age.design.13.14, method="likelihood")

# 2015-2016
svyciprop(~I(anticoag=="Yes"), gp2.can.age.design.15.16, method="likelihood")

# 2017-2018
svyciprop(~I(anticoag=="Yes"), gp2.can.age.design.17.18, method="likelihood")



# Generate a new Table from these Values (for use in generating Figure 5)
gp1gp2.anticoag.trend <- read.table(header=TRUE, text='
cycle can.age.status prop.anticoag lower.CI upper.CI
2011-2012 "All (Age 40-60)" 0.65 0.30 1.00
2011-2012 "All (Age 61+)" 5.32 4.00 7.00
2011-2012 "History of Cancer (Aged 61+)" 6.57 2.86  12.00
2013-2014 "All (Age 40-60)" 0.84 0.54 1.00
2013-2014 "All (Age 61+)" 6.10 5.07 7.00
2013-2014 "History of Cancer (Age 40-60)" 0.41 0.05 1.00 
2013-2014 "History of Cancer (Aged 61+)" 5.89 3.55  9.00
2015-2016 "All (Age 40-60)" 0.63 0.24 1.00
2015-2016 "All (Age 61+)" 6.90 4.92 9.00
2015-2016 "History of Cancer (Age 40-60)" 2.23 0.06 11.00
2015-2016 "History of Cancer (Aged 61+)" 9.15 6.51  12.00
2017-2018 "All (Age 40-60)" 1.07 0.36 2.00
2017-2018 "All (Age 61+)" 6.61 5.12 8.00
2017-2018 "History of Cancer (Age 40-60)" 0.90 0.03 4.00
2017-2018 "History of Cancer (Aged 61+)" 10.42 6.62  15.00
')

gp1gp2.anticoag.trend %>% 
  ggplot(aes(cycle, prop.anticoag, fill = can.age.status, group = can.age.status)) +
  geom_line(color = "black", size = 1) +
  geom_point(colour="black", pch=22, size = 3.6)  + 
  scale_fill_jama() +
  scale_color_jama() + 
  theme_bw() +
  geom_ribbon(data=gp1gp2.anticoag.trend,aes(ymin=lower.CI,ymax=upper.CI),alpha=0.2)   +
  labs(title = "Figure 5. Weighted Prevalence of Anticoagulant Use by Cancer History and Age Group, NHANES 2011-2018") + 
  xlab("Cycle") +
  ylab("Prevalence of Anticoagulant Use (%)") + 
  guides(fill=guide_legend(title="Cancer History and Age Group"))

```

**Analysis of Figure 5:** Figure 5 suggests that the observed differences in anticoagulant use between the overall population and those with a history of cancer (Figure 3) may be largely attributable to the population with a history of cancer being consistently older than the overall population (as stratifying by age removes a substantial amount of the difference in anticoagulant use between these populations).



To provide additional context to our findings regarding the prevalence of preventative aspirin use among those with a history of cancer, trends in preventative aspirin use among those with a history of MI or a history of stroke were also examined (as these represent two other key indications for preventative aspirin use).

```{r eval = TRUE, message = FALSE}

# Assess the weighted proportion of preventative aspirin users in each cycle among those 40 years of age or older with a history of cancer

# 2011-2012
svyciprop(~I(aspirin.any=="Yes"), can.age.design.11.12, method="likelihood")

# 2013-2014
svyciprop(~I(aspirin.any=="Yes"), can.age.design.13.14, method="likelihood")

# 2015-2016
svyciprop(~I(aspirin.any=="Yes"), can.age.design.15.16, method="likelihood")

# 2017-2018
svyciprop(~I(aspirin.any=="Yes"), can.age.design.17.18, method="likelihood")



# Assess the weighted proportion of preventative aspirin users in each cycle among those 40 years of age or older with a history of MI

# 2011-2012
svyciprop(~I(aspirin.any=="Yes"), mi.age.design.11.12, method="likelihood")

# 2013-2014
svyciprop(~I(aspirin.any=="Yes"), mi.age.design.13.14, method="likelihood")

# 2015-2016
svyciprop(~I(aspirin.any=="Yes"), mi.age.design.15.16, method="likelihood")

# 2017-2018
svyciprop(~I(aspirin.any=="Yes"), mi.age.design.17.18, method="likelihood")



# Assess the weighted proportion of preventative aspirin users in each cycle among those 40 years of age or older with a history of stroke

# 2011-2012
svyciprop(~I(aspirin.any=="Yes"), str.age.design.11.12, method="likelihood")

# 2013-2014
svyciprop(~I(aspirin.any=="Yes"), str.age.design.13.14, method="likelihood")

# 2015-2016
svyciprop(~I(aspirin.any=="Yes"), str.age.design.15.16, method="likelihood")

# 2017-2018
svyciprop(~I(aspirin.any=="Yes"), str.age.design.17.18, method="likelihood")



# Generate a new Table from these Values (for use in generating Figure 6)
disease.hist.aspirin.trend <- read.table(header=TRUE, text='
cycle disease.hist prop.aspirin lower.CI upper.CI
2011-2012 "History of Cancer" 43.7 37.0 51.0
2011-2012 "History of MI" 77.1 68.0 85.0
2011-2012 "History of Stroke" 53.1 42.2  64.0
2013-2014 "History of Cancer" 46.5 41.7 51.0
2013-2014 "History of MI" 65.5 56.4 74.0
2013-2014 "History of Stroke" 54.1 44.8  63.0
2015-2016 "History of Cancer" 40.5 34.4 47.0
2015-2016 "History of MI" 68.7 60.2 76.0
2015-2016 "History of Stroke" 58.8 45.4  71.0
2017-2018 "History of Cancer" 40.2 32.8 48.0
2017-2018 "History of MI" 77.8 69.8 85.0
2017-2018 "History of Stroke" 53.2 43.1  63.0
')

disease.hist.aspirin.trend %>% 
  ggplot(aes(cycle, prop.aspirin, fill = disease.hist, group = disease.hist)) +
  geom_line(color = "black", size = 1) +
  geom_point(colour="black", pch=22, size = 3.6)  + 
  scale_fill_uchicago() +
  scale_color_uchicago() + 
  theme_bw() +
  geom_ribbon(data=disease.hist.aspirin.trend,aes(ymin=lower.CI,ymax=upper.CI),alpha=   0.17) +
  labs(title = "Figure 6. Weighted Prevalence of Preventative Aspirin Use by Disease History, NHANES 2011-2018*") + 
  xlab("Cycle") +
  ylab("Prevalence of Preventative Aspirin Use (%)") + 
  guides(fill=guide_legend(title="Disease History")) +
  labs(caption = "*Includes only those 40 years of age or older")

```

**Analysis of Figure 6:** Broadly, Figure 6 suggests that there is greater prevalence of preventative aspirin use among those with a history of MI or a history of stroke compared to those with a history of cancer.  Additionally, the directionality of preventative aspirin use trends between these disease groups appear distinct.  Further assessments are needed to draw more definitive conclusions about these differences.


Finally, the factors associated with preventative aspirin use were evaluated among adults with a history of cancer in the most recent cycle of NHANES data, 2017-2018.

```{r eval = TRUE, message = FALSE}

# Generate univariable logistic regression models to examine factors associated with preventative aspirin use among adults 40 years of age or older with a history of cancer in the most recent cycle of data, 2017-2018 

# Univariable logistic regression for gender 
glm.asp.gender <- (svyglm(aspirin.any~gender, family = quasibinomial, design =                          can.age.design.17.18, na.action = na.omit))

glm.asp.gender %>%
  tbl_regression(
    exponentiate = TRUE, 
    pvalue_fun = ~style_pvalue(.x, digits = 2),
    label = gender ~ "Gender") %>%
  bold_p(t = 0.05) %>%
  bold_labels() %>%
  italicize_levels() %>%
  modify_spanning_header(
  c(estimate, ci, p.value) ~ 
      "**Univariable Logistic Regression for Preventative Aspirin Use**")
    

# Univariable logistic regression for age 
glm.asp.age <- (svyglm(aspirin.any~age, family = quasibinomial, design =                             can.age.design.17.18, na.action = na.omit))

glm.asp.age %>%
  tbl_regression(
    exponentiate = TRUE, 
    pvalue_fun = ~style_pvalue(.x, digits = 2),
    label = age ~ "Age") %>%
  bold_p(t = 0.05) %>%
  bold_labels() %>%
  italicize_levels() %>%
  modify_spanning_header(
  c(estimate, ci, p.value) ~ 
      "**Univariable Logistic Regression for Preventative Aspirin Use**")


# Univariable logistic regression for race 
glm.asp.race <- (svyglm(aspirin.any~race, family = quasibinomial, design =                             can.age.design.17.18, na.action = na.omit))

glm.asp.race %>%
  tbl_regression(
    exponentiate = TRUE, 
    pvalue_fun = ~style_pvalue(.x, digits = 2),
    label = race ~ "Race") %>%
  bold_p(t = 0.05) %>%
  bold_labels() %>%
  italicize_levels() %>%
  modify_spanning_header(
  c(estimate, ci, p.value) ~ 
      "**Univariable Logistic Regression for Preventative Aspirin Use**")


# Univariable logistic regression for recent history of cancer 
glm.asp.recent <- (svyglm(aspirin.any~cancer.recent, family = quasibinomial, design =                    can.age.design.17.18, na.action = na.omit))

glm.asp.recent %>%
  tbl_regression(
    exponentiate = TRUE, 
    pvalue_fun = ~style_pvalue(.x, digits = 2),
    label = cancer.recent ~ "Recent History of Cancer") %>%
  bold_p(t = 0.05) %>%
  bold_labels() %>%
  italicize_levels() %>%
  modify_spanning_header(
  c(estimate, ci, p.value) ~ 
      "**Univariable Logistic Regression for Preventative Aspirin Use**")


# Univariable logistic regression for history of stroke 
glm.asp.stroke <- (svyglm(aspirin.any~hx.stroke, family = quasibinomial, design =                       can.age.design.17.18, na.action = na.omit))

glm.asp.stroke %>%
  tbl_regression(
    exponentiate = TRUE, 
    pvalue_fun = ~style_pvalue(.x, digits = 2),
    label = hx.stroke ~ "History of Stroke") %>%
  bold_p(t = 0.05) %>%
  bold_labels() %>%
  italicize_levels() %>%
  modify_spanning_header(
  c(estimate, ci, p.value) ~ 
      "**Univariable Logistic Regression for Preventative Aspirin Use**")


# Univariable logistic regression for history of MI 
glm.asp.mi <- (svyglm(aspirin.any~hx.mi, family = quasibinomial, design =                           can.age.design.17.18, na.action = na.omit))

glm.asp.mi %>%
  tbl_regression(
    exponentiate = TRUE, 
    pvalue_fun = ~style_pvalue(.x, digits = 2),
    label = hx.mi ~ "History of MI") %>%
  bold_p(t = 0.05) %>%
  bold_labels() %>%
  italicize_levels() %>%
  modify_spanning_header(
  c(estimate, ci, p.value) ~ 
      "**Univariable Logistic Regression for Preventative Aspirin Use**")



# Generate a multivariable logistic regression model to examine factors associated with preventative aspirin use among adults 40 years of age or older with a history of cancer in the most recent cycle of data, 2017-2018 
glm.asp.all <- (svyglm(aspirin.any~gender + age + race + cancer.recent +                             hx.stroke + hx.mi, family = quasibinomial, design =                                  can.age.design.17.18, na.action = na.omit))

glm.asp.all %>%
  tbl_regression(
    exponentiate = TRUE, 
    pvalue_fun = ~style_pvalue(.x, digits = 2),
    label = list(gender ~ "Gender",
    age ~ "Age",
    race ~ "Race",
    cancer.recent ~ "Recent History of Cancer",
    hx.stroke ~ "History of Stroke",
    hx.mi ~ "History of MI")
    ) %>%
  bold_p(t = 0.05) %>%
  bold_labels() %>%
  italicize_levels() %>%
  modify_spanning_header(
  c(estimate, ci, p.value) ~ 
      "**Multivariable Logistic Regression for Preventative Aspirin Use**")

```

**Analysis of Univariable and Multivariable Logistic Regression Models for Preventative Aspirin Use:** For the population with a history of cancer, univariable models suggest significantly increased odds of preventative aspirin use among those with male gender, older age, reported race of "Other", or history of MI. However, following adjustment for all assessed variables, only older age and history of MI were significantly associated with preventative aspirin use.



The factors associated with anticoagulant use were also evaluated among adults with a history of cancer in the most recent cycle of NHANES data, 2017-2018.

```{r eval = TRUE, message = FALSE}

# Generate univariable logistic regression models to examine factors associated with anticoagulant use among adults 40 years of age or older with a history of cancer in the most recent cycle of data, 2017-2018 

# Univariable logistic regression for gender 
glm.ant.gender <- (svyglm(anticoag~gender, family = quasibinomial, design =                             can.age.design.17.18, na.action = na.omit))

glm.ant.gender %>%
  tbl_regression(
    exponentiate = TRUE, 
    pvalue_fun = ~style_pvalue(.x, digits = 2),
    label = gender ~ "Gender") %>%
  bold_p(t = 0.05) %>%
  bold_labels() %>%
  italicize_levels() %>%
  modify_spanning_header(
  c(estimate, ci, p.value) ~ 
      "**Univariable Logistic Regression for Anticoagulant Use**")
    

# Univariable logistic regression for age 
glm.ant.age <- (svyglm(anticoag~age, family = quasibinomial, design =                                can.age.design.17.18, na.action = na.omit))

glm.ant.age %>%
  tbl_regression(
    exponentiate = TRUE, 
    pvalue_fun = ~style_pvalue(.x, digits = 2),
    label = age ~ "Age") %>%
  bold_p(t = 0.05) %>%
  bold_labels() %>%
  italicize_levels() %>%
  modify_spanning_header(
  c(estimate, ci, p.value) ~ 
      "**Univariable Logistic Regression for Anticoagulant Use**")


# Univariable logistic regression for race 
glm.ant.race <- (svyglm(anticoag~race, family = quasibinomial, design =                               can.age.design.17.18, na.action = na.omit))

glm.ant.race %>%
  tbl_regression(
    exponentiate = TRUE, 
    pvalue_fun = ~style_pvalue(.x, digits = 2),
    label = race ~ "Race") %>%
  bold_p(t = 0.05) %>%
  bold_labels() %>%
  italicize_levels() %>%
  modify_spanning_header(
  c(estimate, ci, p.value) ~ 
      "**Univariable Logistic Regression for Anticoagulant Use**")


# Univariable logistic regression for recent history of cancer 
glm.ant.recent <- (svyglm(anticoag~cancer.recent, family = quasibinomial, design =                      can.age.design.17.18, na.action = na.omit))

glm.ant.recent %>%
  tbl_regression(
    exponentiate = TRUE, 
    pvalue_fun = ~style_pvalue(.x, digits = 2),
    label = cancer.recent ~ "Recent History of Cancer") %>%
  bold_p(t = 0.05) %>%
  bold_labels() %>%
  italicize_levels() %>%
  modify_spanning_header(
  c(estimate, ci, p.value) ~ 
      "**Univariable Logistic Regression for Anticoagulant Use**")


# Univariable logistic regression for history of stroke 
glm.ant.stroke <- (svyglm(anticoag~hx.stroke, family = quasibinomial, design =                          can.age.design.17.18, na.action = na.omit))

glm.ant.stroke %>%
  tbl_regression(
    exponentiate = TRUE, 
    pvalue_fun = ~style_pvalue(.x, digits = 2),
    label = hx.stroke ~ "History of Stroke") %>%
  bold_p(t = 0.05) %>%
  bold_labels() %>%
  italicize_levels() %>%
  modify_spanning_header(
  c(estimate, ci, p.value) ~ 
      "**Univariable Logistic Regression for Anticoagulant Use**")


# Univariable logistic regression for history of MI 
glm.ant.mi <- (svyglm(anticoag~hx.mi, family = quasibinomial, design =                              can.age.design.17.18, na.action = na.omit))

glm.ant.mi %>%
  tbl_regression(
    exponentiate = TRUE, 
    pvalue_fun = ~style_pvalue(.x, digits = 2),
    label = hx.mi ~ "History of MI") %>%
  bold_p(t = 0.05) %>%
  bold_labels() %>%
  italicize_levels() %>%
  modify_spanning_header(
  c(estimate, ci, p.value) ~ 
      "**Univariable Logistic Regression for Anticoagulant Use**")



# Generate a multivariable logistic regression model to examine factors associated with anticoagulant use among adults 40 years of age or older with a history of cancer in the most recent cycle of data, 2017-2018 
glm.ant.all <- (svyglm(anticoag~gender + age + race + cancer.recent +                                hx.stroke + hx.mi, family = quasibinomial, design =                                  can.age.design.17.18, na.action = na.omit))

glm.ant.all %>%
  tbl_regression(
    exponentiate = TRUE, 
    pvalue_fun = ~style_pvalue(.x, digits = 2),
    label = list(gender ~ "Gender",
    age ~ "Age",
    race ~ "Race",
    cancer.recent ~ "Recent History of Cancer",
    hx.stroke ~ "History of Stroke",
    hx.mi ~ "History of MI")
    ) %>%
  bold_p(t = 0.05) %>%
  bold_labels() %>%
  italicize_levels() %>%
  modify_spanning_header(
  c(estimate, ci, p.value) ~ 
      "**Multivariable Logistic Regression for Anticoagulant Use**")

```

**Analysis of Univariable and Multivariable Logistic Regression Models for Anticoagulant Use:** For the population with a history of cancer, univariable models suggest significantly increased odds of anticoagulant use among those with older age or history of stroke. Following adjustment for all assessed variables, older age and history of stroke remained significantly associated with anticoagulant use. (Note: Observed racial difference look to be attributable to low numbers in the "Mexican American" and "Other" categories.)



# Conclusions:

This study presents a nationally representative assessment of trends and patterns in preventative aspirin and anticoagulant utilization among adults 40 years of age or older with a history of cancer from 2011-2018.  By 2017-2018, 9,808,892 (40.2%, CI: 32.8-48.0%) and 1,905,493 (7.81%, CI: 4.94-12.0%) were estimated to be taking preventative aspirin and anticoagulants, respectively. Analysis of this descriptive, preliminary data on antithrombotic utilization is ongoing, with the presented findings serving as foundations for future research.  With this, there are multiple limitations which are vital to consider in the interpretation of the above results, including: 1). Drug use and medical history data being exclusively obtained from self-report, raising concerns about the potential for both over- and/or under-reporting; 2). Cross-sectional analysis of data, restricting conclusions about the temporal relationship between cancer and antithrombotic initiation; 3). Age capping at 80 years, complicating investigation of age relative to drug utilization; 4). Recency of cancer diagnosis being challenging to establish from this data and serving as a poor proxy for active cancer status; and, 5). Low numbers in specific sub-categories restricting planned investigations (e.g., unable to investigate findings stratified by cancer type, or among those with a history of both stroke and cancer). However, despite these limitations, this study provides critically needed national estimates of real-world antithrombotic use in those with a history of cancer.  Investigators should build from these findings towards development of clinical studies on the primary and secondary preventative effects of aspirin and anticoagulants relative to thrombotic outcomes, including cancer-associated stokes.


# References:

1. Sanossian N, MD, Djabiras C, BS, Mack WJ, MD, Ovbiagele, Bruce, MD, MS. Trends in Cancer Diagnoses among Inpatients Hospitalized with Stroke. J Stroke Cerebrovasc Dis. 2013;22(7):1146-50.

2. Navi BB, Howard G, Howard VJ, Zhao H, Judd SE, Elkind MSV, et al. The risk of arterial thromboembolic events after cancer diagnosis. Res Pract Thromb Haemost. 2019;3(4):639-51.

3. Navi BB, Howard G, Howard VJ, Zhao H, Judd SE, Elkind MSV, et al. New diagnosis of cancer and the risk of subsequent cerebrovascular events. Neurology. 2018;90(23):e2025-33.

4. Navi BB, Iadecola C. Ischemic stroke in cancer patients: A review of an underappreciated pathology. Ann Neurol. 2018;83(5):873-83.

5. Bang OY, Chung J, Lee MJ, Seo W, Kim G, Ahn M, et al. Cancer-Related Stroke: An Emerging Subtype of Ischemic Stroke with Unique Pathomechanisms. J Stroke. 2020;22(1):1-10.

6. Bruno A, Dovizio M, Tacconelli S, Contursi A, Ballerini P, Patrignani P. Antithrombotic Agents and Cancer. Cancers. 2018;10(8):253.

7. National Center for Health Statistics. About the National Health and Nutrition Examination Survey. 2017. Retrieved from: https://www.cdc.gov/nchs/nhanes/about_nhanes.htm

8. Lumley T. Analysis of Complex Survey Samples. 2020. 
Retrieved from: https://cran.r-project.org/web/packages/survey/survey.pdf


