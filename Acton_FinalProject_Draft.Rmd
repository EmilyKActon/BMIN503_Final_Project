---
title: "National Trends and Utilization Patterns for Antithrombotic Drugs Among Adults with a History of Cancer: NHANES 2011-2018"
author: "Emily Acton"
output: 
  html_document:
    toc: false 
    depth: 3 
    theme: paper 
    highlight: tango
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```  
***


### Overview

Antithrombotic agents have increasingly been recognized as having a role in the treatment of populations with cancer, with purported preventative effects relative to tumorigenesis, metastasis, and cancer-associated thromboses.  In my area of research focus, there has been growing attention to the significantly increased risk of ischemic strokes among those with cancer. Yet, the mechanisms underlying and optimal antithrombotic-based prevention strategies for cancer-associated strokes remain incompletely understood.  An essential step towards building further clinical trials and observational studies to advance this understanding will be assessment of current real-world trends in utilization of antithrombotic drugs among adults with cancer.  

In order to ensure maximal clinical relevance of my exploratory assessment of these trends, I sought guidance from Dr. Scott E. Kasner, MD, MSCE, Dr. Brett L. Cucchiara, MD, and John T. Farrar, MD, PhD, with collective expertise across the fields of vascular neurology, oncology, and epidemiology.  From these meetings, I received key input on which antithrombotic drugs to evaluate, how to define the cancer populations of interest, which variables should be parsed, and how to best present results.  Using the unique combination of interview data on demographics, comorbidities, and medications collected as part of the National Health and Nutrition Examination Survey (NHANES), I aimed to investigate national trends and patterns of antithrombotic drug use among adults with a history of cancer. The final GitHub repository for this project can be found at: https://github.com/EmilyKActon/BMIN503_Final_Project



### Introduction 

Estimates suggest 10% of ischemic strokes occur among those with active cancer, with a markedly increased risk of ischemic stroke demonstrated following incident cancer diagnosis.[1-3]  Moreover, these numbers may be on the rise as recent treatment advancements have dramatically increased the length of survival with cancer.[1]  While in the last few years the topic of cancer-associated stroke has garnered growing attention in the scientific literature, treatment strategies for primary and secondary prevention remain poorly defined, and critically in need of further investigation.[4,5]  Antithrombotic drugs, including antiplatelets and anticoagulants, are central to these stroke prevention strategies.[4,5]  However, research into the effectiveness of these drugs is stymied by gaps in knowledge about current real-world utilization patterns for antithrombotic agents among populations with a history of cancer.  Improved understanding about these utilization trends has value extending well beyond its implications for stroke prevention given mounting evidence of potential anti-tumorigenesis and anti-metastatic properties of antithrombotic drugs, coupled with their recognized importance in cancer-associated venous thromboembolism prevention.[6]

At its core, this research question about antithrombotic drug utilization among adults with a history of cancer exists at the intersection of neurology, oncology, pharmacology, and epidemiology, with the input of all four disciplines necessary to arrive at a meaningful study design and analysis plan.  Furthermore, in-depth interpretation of medication use patterns among the growing population of cancer survivors may connect with and require incorporation of knowledge from an even broader range of fields in medicine and the social sciences.  In my meetings with physician-researchers with expertise in a combination of these fields, I gained vital insights about: 1). Selection of the key anticoagulants for evaluation, specifically aspirin and a grouped category of high-relevance anticoagulants; 2). Definition of the cancer populations of interest, specifically in terms of operationalizing cancer “recency”; 3). Determination of the most critical variables for detailed examination, including age and cancer type; and, 4). Visualization of the data (i.e., best use of Figures/Tables), particularly given the focus of this project is more exploratory in nature.  These insights were integral in the development of my overall analysis plan (described below in the Methods). Building from the knowledge obtained in my consultations with these content experts, I will utilize data collected as part of the National Health and Nutrition Examination Survey (NHANES) to investigate the trends and patterns of antithrombotic use among adults with a history of cancer in the US from 2011-2018.




### Methods
Describe the data used and general methodological approach. Subsequently, incorporate full R code necessary to retrieve and clean data, and perform analysis. Be sure to include a description of code so that others (including your future self) can understand what you are doing and why. 

```{r eval = TRUE, message = FALSE}

# Load all packages used for this project
library(nhanesA) 
library(dplyr)
library(ggsci)
library(ggthemes)
library(survey)
library(reshape2)


```


```{r eval = TRUE, message = FALSE}

# LOad data from relevant modules (DEMO=Demographic Variables & Sample Weights, MCQ=Medical Conditions, RXQ_RX=Prescription Medications, and RXQASA = Preventive Aspirin Use) and cycles (G=2011-2012, H=2013-2014, I=2015-2016, and J=2017-2018)

varlist <- c("DEMO", "MCQ", "RXQ_RX", "RXQASA") 
varlist_years <- paste0(rep(varlist, each = 4), c("_G", "_H", "_I", "_J"))

list_all <- sapply(varlist_years, function(x) {data.frame(nhanes(x))}) 


#Create a data.frame for each module
for(i in 1:length(list_all)) {
  assign(names(list_all)[i], list_all[[i]])
} 

#Remove objects that are no longer needed
rm(list_all)

```



```{r eval = TRUE, message = FALSE}

#Combine modules (DEMO, MCQ, RXQ_RX, RXQASA) to generate 1 larger data.frame per cycle, select and rename relevant variables, replace columns as factors for binary/categorical variables (gender, race, history of cancer, and whether low-dose aspirin was taken for prevention), and remove objects that are no longer needed

#2011-2012
cycle.11.12 <- left_join(DEMO_G, MCQ_G, by="SEQN") 

cycle.11.12 <- left_join(cycle.11.12, RXQ_RX_G, by="SEQN")

cycle.11.12 <- left_join(cycle.11.12, RXQASA_G, by="SEQN") %>%
  select(id = SEQN, cycle = SDDSRVYR, gender = RIAGENDR, age = RIDAGEYR, race =         RIDRETH1, hx.can = MCQ220, type.can1 = MCQ230A, type.can2 = MCQ230B, type.can3 =      MCQ230C, type.can4 = MCQ230D, age.bladder.can = MCQ240A, age.testi.can = MCQ240AA,    age.blood.can = MCQ240B, age.thyroid.can = MCQ240BB, age.bone.can = MCQ240C,          age.uteri.can = MCQ240CC, age.brain.can = MCQ240D, age.other.can = MCQ240DD,          age.unk.can = MCQ240DK, age.breast.can = MCQ240E, age.cervic.can = MCQ240F,           age.colon.can = MCQ240G, age.esoph.can = MCQ240H, age.gallblad.can = MCQ240I,         age.kidney.can = MCQ240J, age.larynx.can = MCQ240K, age.leukem.can = MCQ240L,         age.liver.can = MCQ240M, age.lung.can = MCQ240N, age.lymph.can = MCQ240O,             age.melano.can = MCQ240P, age.mouth.can = MCQ240Q, age.nerv.can = MCQ240R,            age.ovari.can = MCQ240S, age.pancr.can = MCQ240T, age.prost.can = MCQ240U,            age.rectal.can = MCQ240V, age.non.mela.can = MCQ240W, age.unk.skin.can = MCQ240X,     age.soft.can = MCQ240Y, age.stomach.can = MCQ240Z, drug = RXDDRGID, aspirin.dr =      RXQ515, aspirin.own = RXQ520, int.weight = WTINT2YR, psu = SDMVPSU, strata =          SDMVSTRA) %>%
  mutate(gender = factor(gender, levels = c(1, 2), labels = c("Male", "Female"))) %>%
  mutate(race = factor(race, levels = c(3, 1, 2, 4, 5), labels = c("White",             "MexicanAmerican", "Hispanic", "Black", "Other"))) %>%
  mutate(hx.can = factor(hx.can, levels=c(1, 2, 7, 9), labels = c("Yes", "No", NA,      NA))) %>%
  mutate(aspirin.dr = factor(aspirin.dr, levels=c(1, 2, 3, 4), labels = c("Yes", "No",   "Sometimes", "Stopped"))) %>%
  mutate(aspirin.own = factor(aspirin.own, levels=c(1, 2, 7, 9), labels = c("Yes",      "No", NA, NA)))

rm(DEMO_G, MCQ_G, RXQ_RX_G, RXQASA_G)

```

```{r eval = TRUE, message = FALSE}

# Generate a variable for the presence versus absence of an anticoagulants, defined for the purposes of this assessmnet as: direct-acting oral anticoagulants (DOACs) (apixaban [d07804], dabigatran [d07137], rivaroxaban[d07356]); low molecular weight heparins (LMWHs)(dalteparin [d03812] or enoxaparin[d03041]); and,  warfarin [d00022].  Then, apply this dummy variable to all observations for a given id.

#2011-2012
cycle.11.12 <- mutate(cycle.11.12, anticoag = ifelse((drug == "d07804"| drug ==     "d07137"| drug == "d07356"|drug == "d03812"| drug == "d03041"|drug == "d00022"),      1, 0))

anticoag.cycle.11.12 <- cycle.11.12 %>%
  filter(anticoag == 1) %>%
  select(id, anticoag) 

cycle.11.12 <-  cycle.11.12 %>%
  select(-anticoag) 
  
cycle.11.12 <- left_join(cycle.11.12, anticoag.cycle.11.12, by="id")
 
rm(anticoag.cycle.11.12)

#With the variable indicating the presence of anticoagulant drug use applied to all rows for a given id, it is not necessary to keep multiple rows for each id (with these multiple rows initially a byproduct of there being a row for each drug reported by a given id). 
#Identify number of duplicate rows based on id, and remove duplicate rows  

#2011-2012
sum(duplicated(cycle.11.12$id))
cycle.11.12 <- distinct(cycle.11.12, id, .keep_all= TRUE)


```



```{r eval = TRUE, message = FALSE}

# Check number of participants with a reported history of cancer

#2011-2012
table(cycle.11.12$hx.can)


#Divide included NHANES participants with a history of cancer into 2 groups: Distant Cancer History (defined as cancer diagnosed >5 years prior to date of survey participation), and Active Cancer/Recent Cancer History (defined as cancer diagnosed >5 years prior to date of survey participation or cancer diagnosed at >=80 years of age) 

#First, generate a new column by subtracting age at time of survey participation from year of diagnosis for each cancer type

#2011-2012
cycle.11.12 <- cycle.11.12 %>%
  mutate(bladder.can = age - age.bladder.can) %>%
  mutate(testi.can = age - age.testi.can) %>%
  mutate(blood.can = age - age.blood.can) %>%
  mutate(thyroid.can = age - age.thyroid.can) %>%
  mutate(bone.can = age - age.bone.can) %>%
  mutate(uteri.can = age - age.uteri.can) %>%
  mutate(brain.can = age - age.brain.can) %>%
  mutate(other.can = age - age.other.can) %>%
  mutate(unk.can = age - age.unk.can) %>%
  mutate(breast.can = age - age.breast.can) %>%
  mutate(cervic.can = age - age.cervic.can) %>%
  mutate(colon.can = age - age.colon.can) %>%
  mutate(esoph.can = age - age.esoph.can) %>%
  mutate(gallblad.can = age - age.gallblad.can) %>%
  mutate(kidney.can = age - age.kidney.can) %>%
  mutate(larynx.can = age - age.larynx.can) %>%
  mutate(leukem.can = age - age.leukem.can) %>%
  mutate(liver.can = age - age.liver.can) %>%
  mutate(lung.can = age - age.lung.can) %>%
  mutate(lymph.can = age - age.lymph.can) %>%
  mutate(melano.can = age - age.melano.can) %>%
  mutate(mouth.can = age - age.mouth.can) %>%
  mutate(nerv.can = age - age.nerv.can) %>%
  mutate(ovari.can = age - age.ovari.can) %>%
  mutate(pancr.can = age - age.pancr.can) %>%
  mutate(prost.can = age - age.prost.can) %>%
  mutate(rectal.can = age - age.rectal.can) %>%
  mutate(non.mela.can = age - age.non.mela.can) %>%
  mutate(unk.skin.can = age - age.unk.skin.can) %>%
  mutate(soft.can = age - age.soft.can) %>%
  mutate(stomach.can = age - age.stomach.can) 

cycle.11.12[47:77] <- lapply(cycle.11.12[47:77], as.numeric)

cycle.11.12 <- cycle.11.12 %>%
  mutate(bladder.can = ifelse(bladder.can <= 5, 1, 0)) %>%
  mutate(testi.can = ifelse(testi.can <= 5, 1, 0)) %>%
  mutate(blood.can = ifelse(blood.can <= 5, 1, 0)) %>%
  mutate(thyroid.can = ifelse(thyroid.can <= 5, 1, 0)) %>%
  mutate(bone.can = ifelse(bone.can <= 5, 1, 0)) %>%
  mutate(uteri.can = ifelse(uteri.can <= 5, 1, 0)) %>%
  mutate(brain.can = ifelse(brain.can <= 5, 1, 0)) %>%
  mutate(other.can = ifelse(other.can <= 5, 1, 0)) %>%
  mutate(unk.can = ifelse(unk.can <= 5, 1, 0)) %>%
  mutate(breast.can = ifelse(breast.can <= 5, 1, 0)) %>%
  mutate(cervic.can = ifelse(cervic.can <= 5, 1, 0)) %>%
  mutate(colon.can = ifelse(colon.can <= 5, 1, 0)) %>%
  mutate(esoph.can = ifelse(esoph.can <= 5, 1, 0)) %>%
  mutate(gallblad.can = ifelse(gallblad.can <= 5, 1, 0)) %>%
  mutate(kidney.can = ifelse(kidney.can <= 5, 1, 0)) %>%
  mutate(larynx.can = ifelse(larynx.can <= 5, 1, 0)) %>%
  mutate(leukem.can = ifelse(leukem.can <= 5, 1, 0)) %>%
  mutate(liver.can = ifelse(liver.can <= 5, 1, 0)) %>%
  mutate(lung.can = ifelse(lung.can <= 5, 1, 0)) %>%
  mutate(lymph.can = ifelse(lymph.can <= 5, 1, 0)) %>%
  mutate(melano.can = ifelse(melano.can <= 5, 1, 0)) %>%
  mutate(mouth.can = ifelse(mouth.can <= 5, 1, 0)) %>%
  mutate(nerv.can = ifelse(nerv.can <= 5, 1, 0)) %>%
  mutate(ovari.can = ifelse(ovari.can <= 5, 1, 0)) %>%
  mutate(pancr.can = ifelse(pancr.can <= 5, 1, 0)) %>%
  mutate(prost.can = ifelse(prost.can <= 5, 1, 0)) %>%
  mutate(rectal.can = ifelse(rectal.can <= 5, 1, 0)) %>%
  mutate(non.mela.can = ifelse(non.mela.can <= 5, 1, 0)) %>%
  mutate(unk.skin.can = ifelse(unk.skin.can <= 5, 1, 0)) %>%
  mutate(soft.can = ifelse(soft.can <= 5, 1, 0)) %>%
  mutate(stomach.can = ifelse(stomach.can <= 5, 1, 0))


sum.cycle.11.12 <- cycle.11.12 %>%
   select(1, 47:77) %>%
   replace(is.na(.), 0) %>%
   mutate(cancer.recent = rowSums(.[2:32]))%>%
   select(1, 33)

cycle.11.12 <- left_join(cycle.11.12, sum.cycle.11.12, by="id")
 
rm(sum.cycle.11.12)

View(cycle.test[47:77])


```


```{r eval = TRUE, message = FALSE}

# Use 'svydesign' (from 'survey') to assign the weights/design elements of NHANES

#2011-2012

cycle.11.12.nhanes <- svydesign(id = ~psu,
                          strata  = ~strata,
                          weights = ~int.weight,
                          nest    = TRUE,
                          survey.lonely.psu = "adjust",
                          data    = cycle.11.12)


# Subset to those 40 years of age or older (with non-missing age information)

#2011-2012
ageDesign <- subset(cycle.11.12.nhanes, age > 39)

```


### Results
Describe your results and include relevant tables, plots, and code/comments used to obtain them. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.



```{r cars}
fig.cycle.11.12 <- cycle.11.12 %>%
   select(1, 47:77) 

fig.cycle.11.12 <- melt(fig.cycle.11.12, id.vars="id") %>%
   filter(value==1) 

ggplot(data = fig.cycle.11.12, aes(x = variable)) +
    geom_bar(position = "dodge")
```


#### References:

1. Sanossian N, MD, Djabiras C, BS, Mack WJ, MD, Ovbiagele, Bruce, MD, MS. Trends in Cancer Diagnoses among Inpatients Hospitalized with Stroke. J Stroke Cerebrovasc Dis. 2013;22(7):1146-50.

2. Navi BB, Howard G, Howard VJ, Zhao H, Judd SE, Elkind MSV, et al. The risk of arterial thromboembolic events after cancer diagnosis. Res Pract Thromb Haemost. 2019;3(4):639-51.

3. Navi BB, Howard G, Howard VJ, Zhao H, Judd SE, Elkind MSV, et al. New diagnosis of cancer and the risk of subsequent cerebrovascular events. Neurology. 2018;90(23):e2025-33.

4. Navi BB, Iadecola C. Ischemic stroke in cancer patients: A review of an underappreciated pathology. Ann Neurol. 2018;83(5):873-83.

5. Bang OY, Chung J, Lee MJ, Seo W, Kim G, Ahn M, et al. Cancer-Related Stroke: An Emerging Subtype of Ischemic Stroke with Unique Pathomechanisms. J Stroke. 2020;22(1):1-10.

6.	Bruno A, Dovizio M, Tacconelli S, Contursi A, Ballerini P, Patrignani P. Antithrombotic Agents and Cancer. Cancers. 2018;10(8):253.
